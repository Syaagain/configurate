<div class="custom-progress-container">
  <p class="step-label"><span id="step-number">Schritt 1</span> von 4</p>
  <div class="progress">
    <div id="progress-bar" class="progress-bar"></div>
  </div>
  <h2 id="step-heading" class="step-heading">Willkommen</h2>

  <!-- Hinweistext -->
  <p id="info-label" class="info-label">
    *Bitte f√ºllen Sie alle Informationen aus, damit wir Ihre Anfrage bearbeiten k√∂nnen.
  </p>

  <!-- Pers√∂nliche Daten -->
  <div id="personal-form" class="form-fields">
    <div class="form-row">
      <div class="form-group">
        <label for="firstName">Vorname *</label>
        <input type="text" id="firstName" placeholder="Geben Sie Ihren Vornamen ein" required />
        <span class="validation-message">Bitte geben Sie einen g√ºltigen Vornamen ein.</span>
      </div>
      <div class="form-group">
        <label for="lastName">Nachname *</label>
        <input type="text" id="lastName" placeholder="Geben Sie Ihren Nachnamen ein" required />
        <span class="validation-message">Bitte geben Sie einen g√ºltigen Nachnamen ein.</span>
      </div>
    </div>
    <div class="form-group full">
      <label for="email">E-Mail-Adresse *</label>
      <input type="email" id="email" placeholder="Geben Sie Ihre E-Mail-Adresse ein" required />
      <span class="validation-message">Bitte geben Sie eine g√ºltige E-Mail-Adresse ein.</span>
    </div>
   <div class="form-group full">
  <label for="phone">Telefonnummer *</label>
  <div style="display: flex; gap: 10px;">
    <select id="countryCode" style="flex: 0.4; padding: 10px 12px; border-radius: 8px;">
      <option value="+49">DE +49</option>
      <option value="+43">AT +43</option>         <!-- √ñsterreich -->
      <option value="+41">CH +41</option>         <!-- Schweiz -->
      <option value="+31">NL +31</option>         <!-- Niederlande -->
      <option value="+32">BE +32</option>         <!-- Belgien -->
      <option value="+33">FR +33</option>         <!-- Frankreich -->
      <option value="+352">LU +352</option>       <!-- Luxemburg -->
      <option value="+420">CZ +420</option>       <!-- Tschechien -->
      <option value="+48">PL +48</option>         <!-- Polen -->
      <option value="+45">DK +45</option>         <!-- D√§nemark -->
      <option value="+1">US +1</option>
      <!-- Weitere bei Bedarf -->
    </select>
    <input type="tel" id="phone" placeholder="1234567890" style="flex: 1;" />
  </div>
</div>

  </div>

  <!-- Schritt 2: Zimmerdetails -->
<div id="room-details" class="room-details" style="display: none;">
  <div class="form-group full">
    <label for="roomSelect">Raum w√§hlen *</label>
    <select id="roomSelect">
      <option value="">Bitte w√§hlen...</option>
      <option value="Wohnzimmer">Wohnzimmer</option>
      <option value="Schlafzimmer">Schlafzimmer</option>
      <option value="K√ºche">K√ºche</option>
      <option value="Badezimmer">Badezimmer</option>
      <option value="Sonstiges">Sonstiges</option>
    </select>
  </div>

  <div class="form-group full">
    <label for="roomSize">Quadratmeter *</label>
    <input type="text" id="roomSize" placeholder="z. B. 25" pattern="\d*" inputmode="numeric" />
    <span class="validation-message" id="roomSizeValidation">Bitte geben Sie eine g√ºltige Quadratmeterzahl ein.</span>
  </div>

    <h3 class="materials-heading">Materialvorschl√§ge *</h3>
    <div class="material-grid">
      <div class="material-card">
        <img src="https://media.istockphoto.com/id/1318680899/de/foto/leichter-naturholzhintergrund.jpg?s=2048x2048&w=is&k=20&c=BxLs3us-4r5dHJVGdy7fRtUBdd3TFaQXxlF91vW14zs=" alt="Holzboden" />
        <strong>Holzboden</strong>
        <p>Klassisch und langlebig</p>
      </div>
      <div class="material-card">
        <img src="https://media.istockphoto.com/id/946593026/de/vektor/vektor-wei%C3%9Fen-modernen-abstrakten-hintergrund.jpg?s=2048x2048&w=is&k=20&c=fesT_EAHphSvTx7HBSUP8MzZkkzstcQVhxWltB36e1c=" alt="Fliese" />
        <strong>Fliesen</strong>
        <p>Elegant und wasserfest</p>
      </div>
      <div class="material-card">
        <img src="https://media.istockphoto.com/id/2138862337/de/foto/carpet.jpg?s=2048x2048&w=is&k=20&c=p42TW4njRY436DDwTwm33PWMNlgbcsez5r6fFBi5GgE=" alt="Teppich" />
        <strong>Teppich</strong>
        <p>Weich und schallabsorbierend</p>
      </div>
      <div class="material-card">
        <img src="https://media.istockphoto.com/id/185250199/de/foto/h%C3%B6lzerne-hintergrund.jpg?s=2048x2048&w=is&k=20&c=fm0-yurZ419FBpf-GZ_Qxgm6yZuEOkcykam9NbDXl4M=" alt="Laminat" />
        <strong>Laminat</strong>
        <p>Vielseitig und pflegeleicht</p>
      </div>
      <div class="material-card">
        <img src="https://media.istockphoto.com/id/2155668586/de/foto/schwarze-matte-kunststoffmaterialstruktur.jpg?s=2048x2048&w=is&k=20&c=e_pF9EQ3zkKR5h2LZdX286mnGYtwVACn8ywU0gPlBeo=" alt="Vinyl" />
        <strong>Vinyl</strong>
        <p>Wasserfest und einfach zu reinigen</p>
      </div>
    </div>

    <button type="button" id="addRoomButton" class="start-button" style="margin-bottom: 20px;">Hinzuf√ºgen</button>

      <div id="roomList" class="room-list"></div>
  </div>
  
  <!-- Schritt 3: Bilder hochladen -->
  <div id="image-upload" class="image-upload" style="display: none;">
    <div id="drop-zone" class="drop-zone">
      <p><strong>Ziehe deine Bilder hierher</strong><br />oder klicke zum Durchsuchen</p>
      <input type="file" id="file-input" accept=".pdf,image/jpeg,image/jpg" multiple hidden />
      <button type="button" id="upload-button">Hochladen</button>
    </div>

    <div class="uploaded-images">
      <h4>Hochgeladene Bilder</h4>
      <div id="gallery" class="gallery"></div>
    </div>
  </div>
  
  <!-- Schritt 4: Zusammenfassung -->
<div id="review-summary" class="review-summary" style="display: none;">
  <div class="review-section">
    <h4 style="display: flex; align-items: center; justify-content: space-between;">
        Pers√∂nliche Daten
    <div class="tooltip-container">
      <button class="edit-button" onclick="goToStep(1)">‚úèÔ∏è</button>
    <span class="tooltip-text">Bearbeiten</span>
  </div>

    </h4>

    <ul>
      <li><strong>Vorname:</strong> <span id="summaryFirstName"></span></li>
      <li><strong>Nachname:</strong> <span id="summaryLastName"></span></li>
      <li><strong>E-Mail:</strong> <span id="summaryEmail"></span></li>
      <li><strong>Telefonnummer:</strong> <span id="summaryPhone"></span></li>
    </ul>
  </div>

  <div class="review-section">
    <h4 style="display: flex; align-items: center; justify-content: space-between;">
        Zimmerdetails
        <div class="tooltip-container">
          <button class="edit-button" onclick="goToStep(2)">‚úèÔ∏è</button>
        <span class="tooltip-text">Bearbeiten</span>
      </div>
    </h4>
    <ul>
      <li><span id="summaryRoom"></span></li>
      <li><span id="summaryMaterial"></span></li>
    </ul>
  </div>

  <div class="review-section">
    <h4 style="display: flex; align-items: center; justify-content: space-between;">
        Hochgeladene Bilder
      <div class="tooltip-container">
        <button class="edit-button" onclick="goToStep(3)">‚úèÔ∏è</button>
        <span class="tooltip-text">Bearbeiten</span>
      </div>
    </h4>
    <div id="summaryGallery" class="gallery"></div>
  </div>
</div>

<!-- Buttons am Ende des Containers -->
<button id="start-button" class="start-button" disabled>Weiter</button>
<button id="submit-button" class="start-button" style="display: none;">Absenden</button>


<style>
  .custom-progress-container {
    font-family: Arial, sans-serif;
    max-width: 600px;
    padding: 40px 20px;
    margin: 0 auto;
  }

  .step-label {
    font-size: 14px;
    margin-bottom: 6px;
    text-align: center;
  }

  .progress {
    width: 100%;
    height: 8px;
    background-color: #e0e4e8;
    border-radius: 4px;
    margin-bottom: 30px;
    position: relative;
  }

  .progress-bar {
    width: 25%;
    height: 100%;
    background-color: #000;
    border-radius: 4px;
    transition: width 0.3s ease;
  }

  .step-heading {
    text-align: center;
    font-size: 20px;
    font-weight: bold;
    margin-top: 0;
  }

  .info-label {
    font-size: 14px;
    color: #555;
    text-align: center;
    margin-bottom: 20px;
  }

  .form-fields {
    margin-bottom: 30px;
  }

  .form-row {
    display: flex;
    gap: 20px;
    flex-wrap: wrap;
  }

  .form-group {
    flex: 1;
    display: flex;
    flex-direction: column;
    margin-bottom: 20px;
  }

  .form-group.full {
    width: 100%;
  }

  .form-group label {
    margin-bottom: 6px;
    font-weight: bold;
  }

  .form-group input,
  #roomSelect {
    padding: 10px 12px;
    border: none;
    background-color: #f1f3f5;
    border-radius: 8px;
    font-size: 14px;
  }

  .start-button {
    display: block;
    margin: 30px auto 0 auto;
    padding: 12px 24px;
    font-size: 16px;
    background-color: #000;
    color: #fff;
    border: none;
    border-radius: 6px;
    cursor: pointer;
  }

  .start-button:hover:not(:disabled) {
    background-color: #333;
  }

  .start-button:disabled {
    background-color: #999;
    cursor: not-allowed;
  }

  /* Schritt 2 */
  .room-details {
    margin-top: 20px;
  }

  .materials-heading {
    margin: 30px 0 10px;
    font-size: 18px;
    font-weight: bold;
  }

  .material-grid {
    display: flex;
    flex-wrap: wrap;
    gap: 20px;
    justify-content: space-between;
  }

  .material-card {
    flex: 1 1 120px;
    min-width: 120px;
    max-width: 150px;
    background: #fff;
    text-align: center;
    padding: 10px;
    border-radius: 8px;
    box-shadow: 0 1px 4px rgba(0, 0, 0, 0.05);
    cursor: pointer;
    border: 2px solid transparent;
    transition: 0.2s ease;
  }

  .material-card:hover {
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
  }

  .material-card.selected {
    border: 2px solid #000;
    background-color: #f0f0f0;
  }

  .material-card img {
    width: 100%;
    height: auto;
    border-radius: 6px;
    margin-bottom: 8px;
  }

  .material-card p {
    font-size: 13px;
    color: #555;
    margin: 0;
  }
  
  .image-upload {
    margin-top: 30px;
  }

  .upload-heading {
    text-align: center;
    font-size: 22px;
    margin-bottom: 20px;
  }

  .drop-zone {
    border: 2px dashed #ccc;
    padding: 40px;
    text-align: center;
    border-radius: 12px;
    cursor: pointer;
    margin-bottom: 30px;
  }

  .drop-zone:hover {
    background-color: #f9f9f9;
  }

  .drop-zone p {
    margin: 0 0 15px;
    font-size: 16px;
  }

  .drop-zone button {
    padding: 10px 20px;
    font-size: 14px;
    border: none;
    border-radius: 6px;
    background-color: #eee;
    cursor: pointer;
  }

  .uploaded-images h4 {
    margin-bottom: 10px;
  }

  .gallery {
    display: flex;
    gap: 20px;
    flex-wrap: wrap;
  }

  .gallery img {
    width: 160px;
    height: auto;
    border-radius: 10px;
    object-fit: cover;
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
  }
  
  .review-summary {
  margin-top: 30px;
}

.review-section {
  margin-bottom: 30px;
}

.review-section h4 {
  margin-bottom: 10px;
  font-size: 16px;
}

.review-section ul {
  list-style: none;
  padding: 0;
  margin: 0;
}

.review-section ul li {
  padding: 4px 0;
  font-size: 14px;
}

input {
  border: 2px solid #000; /* Standard: schwarz */
}

input.touched.invalid {
  border-color: #e74c3c;
}

input.touched.valid {
  border-color: #2ecc71;
}

.validation-message {
  display: none;
  font-size: 12px;
  color: #e74c3c;
  margin-top: -10px;
  margin-bottom: 10px;
}

.form-group input.touched.invalid ~ .validation-message {
  display: block;
}

.edit-button {
  background: none;
  border: none;
  font-size: 18px;
  cursor: pointer;
  padding: 4px;
  color: #000;
}
.edit-button:hover {
  color: #555;
}

.tooltip-container {
  position: relative;
  display: inline-block;
}

.tooltip-text {
  visibility: hidden;
  background-color: #000;
  color: #fff;
  text-align: center;
  border-radius: 6px;
  padding: 4px 8px;
  font-size: 12px;
  position: absolute;
  z-index: 1;
  top: -5px;
  right: 130%;
  opacity: 0;
  transition: opacity 0.3s;
  white-space: nowrap;
}

.tooltip-container:hover .tooltip-text {
  visibility: visible;
  opacity: 1;
}

</style>

<script>
  let currentStep = 1;
  const maxSteps = 4;

  const stepNumber = document.getElementById('step-number');
  const progressBar = document.getElementById('progress-bar');
  const stepHeading = document.getElementById('step-heading');
  const startButton = document.getElementById('start-button');
  const submitButton = document.getElementById('submit-button'); 
  const infoLabel = document.getElementById('info-label');
  const countryCode = document.getElementById('countryCode');

  const formFields = document.getElementById('personal-form');
  const roomDetails = document.getElementById('room-details');
  const imageUpload = document.getElementById('image-upload');
  const reviewSummary = document.getElementById('review-summary');

  const firstName = document.getElementById('firstName');
  const lastName = document.getElementById('lastName');
  const email = document.getElementById('email');
  const phone = document.getElementById('phone');

  const roomSelect = document.getElementById('roomSelect');
  const roomSize = document.getElementById('roomSize');
  const roomSizeValidation = document.getElementById('roomSizeValidation');
  const addRoomButton = document.getElementById('addRoomButton');
  const roomList = document.getElementById('roomList');
  let selectedRooms = [];
  let selectedMaterial = null;

  const dropZone = document.getElementById('drop-zone');
  const fileInput = document.getElementById('file-input');
  const gallery = document.getElementById('gallery');
  const uploadButton = document.getElementById('upload-button');

  const summaryFirstName = document.getElementById('summaryFirstName');
  const summaryLastName = document.getElementById('summaryLastName');
  const summaryEmail = document.getElementById('summaryEmail');
  const summaryPhone = document.getElementById('summaryPhone');
  const summaryRoom = document.getElementById('summaryRoom');
  const summaryMaterial = document.getElementById('summaryMaterial');
  const summaryGallery = document.getElementById('summaryGallery');

  const materialCards = document.querySelectorAll('.material-card');

  materialCards.forEach(card => {
    card.addEventListener('click', () => {
      const isSelected = card.classList.contains('selected');
      materialCards.forEach(c => c.classList.remove('selected'));
      if (!isSelected) {
        card.classList.add('selected');
        selectedMaterial = card.querySelector('strong')?.innerText || null;
      } else {
        selectedMaterial = null;
      }
      validateStep2();
    });
  });

  const headings = [
    "Willkommen",
    "Zimmerdetails",
    "Bilder hochladen",
    "Anfrage √ºberpr√ºfen"
  ];

  // Schritt 1 validieren
function validateStep1() {
  let isValid = true;

  // Vorname pr√ºfen (mindestens 2 Buchstaben, nur Buchstaben)
  const nameRegex = /^[A-Za-z√Ñ√ñ√ú√§√∂√º√ü\s-]{2,}$/;
  if (!nameRegex.test(firstName.value.trim())) {
    markInvalid(firstName);
    isValid = false;
  } else {
    markValid(firstName);
  }

  // Nachname pr√ºfen
  if (!nameRegex.test(lastName.value.trim())) {
    markInvalid(lastName);
    isValid = false;
  } else {
    markValid(lastName);
  }

  // E-Mail pr√ºfen
  const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
  if (!emailRegex.test(email.value.trim())) {
    markInvalid(email);
    isValid = false;
  } else {
    markValid(email);
  }

  // Telefonnummer pr√ºfen (nur Ziffern, mindestens 5 Stellen)
  if (!/^\d{5,}$/.test(phone.value.trim())) {
    markInvalid(phone);
    isValid = false;
  } else {
    markValid(phone);
  }

  startButton.disabled = !isValid;
}

function markInvalid(input) {
  input.classList.remove("valid");
  input.classList.add("invalid");
}

function markValid(input) {
  input.classList.remove("invalid");
  input.classList.add("valid");
}

 // Event-Handler f√ºr Schritt 1
[firstName, lastName, email, phone].forEach(input => {
  input.addEventListener("blur", () => {
    input.classList.add("touched");
    validateStep1();
  });

  input.addEventListener("input", () => {
    validateStep1();
  });
});

 // Schritt 2 validieren
function validateStep2() {
  let isRoomSelected = roomSelect.value !== '';
  let sizeValid = parseInt(roomSize.value) > 0;
  let hasMaterial = selectedMaterial !== null;

  roomSize.classList.add("touched");
  if (!sizeValid && roomSize.value.trim() !== '') {
    roomSize.classList.remove("valid");
    roomSize.classList.add("invalid");
    roomSizeValidation.style.display = 'block';
  } else {
    roomSize.classList.remove("invalid");
    if (roomSize.value.trim() !== '') {
      roomSize.classList.add("valid");
    }
    roomSizeValidation.style.display = 'none';
  }

  const enableMaterials = isRoomSelected && sizeValid;
  materialCards.forEach(card => {
    card.style.pointerEvents = enableMaterials ? "auto" : "none";
    card.style.opacity = enableMaterials ? "1" : "0.5";
  });

  // Hinzuf√ºgen-Button aktivieren, wenn alle drei g√ºltig sind
  addRoomButton.disabled = !(isRoomSelected && sizeValid && hasMaterial);

  // Weiter-Button aktivieren, wenn mindestens ein Eintrag gespeichert wurde
  startButton.disabled = !(selectedRooms.length > 0);
}

// Initial deaktivieren
addRoomButton.disabled = true;
roomSizeValidation.style.display = 'none';

roomSelect.addEventListener("change", validateStep2);
roomSize.addEventListener("input", validateStep2);

// Events anpassen (z.‚ÄØB. nach Materialauswahl validieren)
addRoomButton.addEventListener("click", () => {
  const room = roomSelect.value;
  const size = roomSize.value;
  const material = selectedMaterial;

  if (room && parseInt(size) > 0 && material) {
    const roomKeyRaw = room.toLowerCase().replace('√§', 'ae').replace('√∂', 'oe').replace('√º', 'ue');

    const fieldMap = {
      wohnzimmer: 'living_room',
      schlafzimmer: 'bed_room',
      badezimmer: 'bathroom',
      kueche: 'kitchen'
    };

    const mappedRoom = fieldMap[roomKeyRaw]; 

    selectedRooms = selectedRooms.filter(r => r.roomLabel !== room);

    // Speichern ‚Äì mit oder ohne API-Schl√ºssel
    selectedRooms.push({
      roomKey: mappedRoom || null,
      roomLabel: room,
      size,
      material
    });

    // UI zur√ºcksetzen
    roomSelect.value = '';
    roomSize.value = '';
    selectedMaterial = null;
    materialCards.forEach(c => c.classList.remove('selected'));
    roomSize.classList.remove("valid", "invalid", "touched");

    validateStep2();
    updateRoomList();
  }
});

function updateRoomList() {
  roomList.innerHTML = '';

  if (selectedRooms.length === 0) return;

  const table = document.createElement('table');
  table.style.width = '100%';
  table.style.borderCollapse = 'collapse';
  table.style.marginTop = '10px';

  const headerRow = document.createElement('tr');
  ['Raum', 'Gr√∂√üe', 'Material'].forEach(text => {
    const th = document.createElement('th');
    th.textContent = text;
    th.style.borderBottom = '1px solid #ccc';
    th.style.textAlign = 'left';
    th.style.padding = '6px';
    headerRow.appendChild(th);
  });
  table.appendChild(headerRow);

  selectedRooms.forEach(entry => {
  const row = document.createElement('tr');
    [entry.roomLabel, `${entry.size} m¬≤`, entry.material].forEach(val => {
      const td = document.createElement('td');
      td.textContent = val;
      td.style.padding = '6px';
      row.appendChild(td);
    });
    table.appendChild(row);
  });
  roomList.appendChild(table);
}

  // Weiter-Button (Schritt 1‚Äì3)
  startButton.addEventListener("click", () => {
    if ((currentStep === 1 && startButton.disabled) || (currentStep === 2 && startButton.disabled)) {
      return;
    }

    if (currentStep < maxSteps) {
      currentStep++;
      window.scrollTo({ top: 0, behavior: 'smooth' });
      stepNumber.textContent = `Schritt ${currentStep}`;
      progressBar.style.width = `${currentStep * 25}%`;
      stepHeading.textContent = headings[currentStep - 1];

      // Zeige/Verstecke Buttons
      startButton.style.display = currentStep < maxSteps ? "block" : "none";
      submitButton.style.display = currentStep === maxSteps ? "block" : "none";

      // Inhalt sichtbar machen
      formFields.style.display = currentStep === 1 ? "block" : "none";
      roomDetails.style.display = currentStep === 2 ? "block" : "none";
      imageUpload.style.display = currentStep === 3 ? "block" : "none";
      reviewSummary.style.display = currentStep === 4 ? "block" : "none";

      if (currentStep === 2) {
        validateStep2();
      } else {
        startButton.disabled = false;
      }

      // Schritt 4 zusammenfassen
     if (currentStep === 4) {

      infoLabel.textContent = "Bitte √ºberpr√ºfen Sie alle Informationen nochmal gr√ºndlich.";

      summaryFirstName.textContent = firstName.value;
      summaryLastName.textContent = lastName.value;
      summaryEmail.textContent = email.value;
      summaryPhone.textContent = `${countryCode.value} ${phone.value}`;

    // Raum-√úbersicht als Tabelle
    summaryRoom.innerHTML = '';
    if (selectedRooms.length > 0) {
      const table = document.createElement('table');
      table.style.width = '100%';
      table.style.borderCollapse = 'collapse';

      const headerRow = document.createElement('tr');
      ['Raum', 'Gr√∂√üe', 'Material'].forEach(text => {
        const th = document.createElement('th');
        th.textContent = text;
        th.style.borderBottom = '1px solid #ccc';
        th.style.textAlign = 'left';
        th.style.padding = '6px';
        headerRow.appendChild(th);
      });
      table.appendChild(headerRow);

      selectedRooms.forEach(entry => {
        const row = document.createElement('tr');
        [entry.roomLabel, `${entry.size} m¬≤`, entry.material].forEach(val => {
          const td = document.createElement('td');
          td.textContent = val;
          td.style.padding = '6px';
          row.appendChild(td);
        });
        table.appendChild(row);
      });

      summaryRoom.appendChild(table);
    } else {
      summaryRoom.textContent = 'Keine Angaben gemacht';
    }

    summaryMaterial.textContent = ''; // wird jetzt in der Tabelle dargestellt
    summaryGallery.innerHTML = "";

    // Alle Elemente aus dem Gallery-Container (img oder PDF-Karten)
    gallery.childNodes.forEach(node => {
      const clone = node.cloneNode(true);
      summaryGallery.appendChild(clone);
    });

  }
    }
  });

  function goToStep(step) {
      if (step < 1 || step > maxSteps) return;

      currentStep = step;
      stepNumber.textContent = `Schritt ${currentStep}`;
      progressBar.style.width = `${currentStep * 25}%`;
      stepHeading.textContent = headings[currentStep - 1];
      window.scrollTo({ top: 0, behavior: 'smooth' });

      formFields.style.display = currentStep === 1 ? "block" : "none";
      roomDetails.style.display = currentStep === 2 ? "block" : "none";
      imageUpload.style.display = currentStep === 3 ? "block" : "none";
      reviewSummary.style.display = currentStep === 4 ? "block" : "none";

      startButton.style.display = currentStep < maxSteps ? "block" : "none";
      submitButton.style.display = currentStep === maxSteps ? "block" : "none";

      if (currentStep === 1) validateStep1();
      if (currentStep === 2) validateStep2();
  }

  // Bild Uploads

  dropZone.addEventListener('dragover', (e) => {
    e.preventDefault();
    dropZone.style.backgroundColor = '#f1f1f1';
  });

  phone.addEventListener("input", () => {
    // Erlaube nur Zahlen
    phone.value = phone.value.replace(/\D/g, "");
   validateStep1();
  });

  dropZone.addEventListener('dragleave', () => {
    dropZone.style.backgroundColor = 'transparent';
  });

  dropZone.addEventListener('drop', (e) => {
    e.preventDefault();
    dropZone.style.backgroundColor = 'transparent';
    handleFiles(e.dataTransfer.files);
  });

  uploadButton.addEventListener('click', () => fileInput.click());

  fileInput.addEventListener('change', () => {
    handleFiles(fileInput.files);
  });

function handleFiles(files) {
  const allowedTypes = ['application/pdf', 'image/jpeg', 'image/jpg'];

  Array.from(files).forEach(file => {
    if (!allowedTypes.includes(file.type)) {
      alert(`Dateiformat nicht erlaubt: ${file.name}`);
      return;
    }

    const reader = new FileReader();
    reader.onload = (e) => {
      const wrapper = document.createElement('div');
      wrapper.style.width = '160px';
      wrapper.style.border = '1px solid #ddd';
      wrapper.style.borderRadius = '10px';
      wrapper.style.overflow = 'hidden';
      wrapper.style.boxShadow = '0 2px 5px rgba(0,0,0,0.1)';
      wrapper.style.background = '#fff';
      wrapper.style.textAlign = 'center';
      wrapper.style.display = 'flex';
      wrapper.style.flexDirection = 'column';
      wrapper.style.justifyContent = 'center';
      wrapper.style.padding = '10px';

      if (file.type === 'application/pdf') {
        const icon = document.createElement('div');
        icon.innerHTML = 'üìÑ';
        icon.style.fontSize = '48px';
        icon.style.marginBottom = '8px';

        const filename = document.createElement('div');
        filename.textContent = file.name;
        filename.style.fontSize = '12px';
        filename.style.overflow = 'hidden';
        filename.style.textOverflow = 'ellipsis';
        filename.style.whiteSpace = 'nowrap';

        wrapper.appendChild(icon);
        wrapper.appendChild(filename);
      } else {
        const img = document.createElement('img');
        img.src = e.target.result;
        img.style.width = '100%';
        img.style.height = 'auto';
        img.style.objectFit = 'cover';
        wrapper.appendChild(img);
      }

      gallery.appendChild(wrapper);
    };

    reader.readAsDataURL(file);
  });
}

 configJson = {
  "baseUrl": "https://marketplace.gohighlevel.com",
  "clientId": "684738bd49eac24e868b4001-mbpi9wpo",
  "clientSecret": "e29f60ba-aba5-49ea-a91f-30225d29563e",
}

// Authentication
async function initiateAuth(req, res) {
  const options = {
    requestType: "code",
    redirectUri: "http://localhost:3000/oauth/callback",
    clientId: configJson.clientId,
    scopes: [
      "contacts.write",
      "contacts.readonly"
    ]
  }
  return res.redirect(`${configJson.baseUrl}/oauth/chooselocation?response_type=${options.requestType}&redirect_uri=${options.redirectUri}&client_id=${options.clientId}&scope=${options.scopes.join(' ')}`);
}

  // Submit an GoHighLevel
  submitButton.addEventListener("click", () => {
    submitToHighLevel();
  });

  async function submitToHighLevel() {
    const token = 'Bearer pit-df626d04-ebd5-45d8-8548-d589f9d5c903'; // Bearer Token
    const customFields = [];

  selectedRooms.forEach(({ roomKey, size, material }) => {
    if (roomKey) {
      customFields.push({ key: `${roomKey}_size`, field_value: size });
      customFields.push({ key: `${roomKey}_material`, field_value: material });
    }
  });


    const contactPayload = {
      firstName: firstName.value.trim(),
      lastName: lastName.value.trim(),
      email: email.value.trim(),
      locationId:'YYXLV6WpBo7IkhlFP97b',
      phone: phone.value.trim(),
      customFields,
      source: 'Public Form'
    };

    try {
      const resp = await fetch('https://services.leadconnectorhq.com/contacts/', {
        method: 'POST',
        headers: {
          'Accept': 'application/json',
          'Authorization': token,
          'Content-Type': 'application/json',
          'Version': '2021-07-28'
        },
        body: JSON.stringify(contactPayload)
      });

    const data = await resp.json();

    if (!resp.ok) {
      console.error("Fehler beim Erstellen:", data);
      alert('Fehler beim Erstellen des Kontakts: ' + (data.error || JSON.stringify(data)));
      return;
    }

      // Bilder anh√§ngen

      alert('Kontakt erfolgreich erstellt! ‚úÖ');
    } catch (err) {
      console.error(err);
      alert('Fehler beim Absenden: ' + err.message);
    }
  }
</script>
