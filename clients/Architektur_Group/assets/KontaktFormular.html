<!-- ===================================== -->
<!-- Schritt 1: Persönliche Daten -->
<!-- ===================================== -->

<div class="custom-progress-container">
  <p class="step-label"><span id="step-number">Schritt 1</span> von 4</p>
  <div class="progress">
    <div id="progress-bar" class="progress-bar"></div>
  </div>
  <h2 id="step-heading" class="step-heading">Willkommen</h2>

  <!-- Hinweistext -->
  <p id="info-label" class="info-label">
    *Bitte füllen Sie alle Informationen aus, damit wir Ihre Anfrage bearbeiten können.
  </p>

  <!-- Persönliche Daten -->
  <div id="personal-form" class="form-fields">
    <div class="form-row">
     <div class="form-group">
      <label for="firstName">Vorname *</label>
      <input type="text" id="firstName" placeholder="Vorname..." autocomplete="off"/>
    </div>
    <div class="form-group">
      <label for="lastName">Nachname *</label>
      <input type="text" id="lastName" placeholder="Nachnamen..." autocomplete="off" />
    </div>
    </div>
    <div class="form-group full">
      <label for="email">E-Mail-Adresse *</label>
      <input type="email" id="email" placeholder="E-Mail-Adresse..." name="fake_email" autocomplete="off" />
    </div>
    <div class="form-group full">
      <label for="phone">Telefonnummer *</label>
      <div class="phone-input-group">
        <div class="form-field like-input">
          <div class="custom-select-wrapper">
            <div class="custom-select" id="customCountryCode">
              <div class="selected-option">
                <span class="selected-text">DE +49</span>
                <span class="dropdown-icon">▾</span>
              </div>
              <div class="options-list hidden">
                <div data-value="+49">DE +49</div>
                <div data-value="+43">AT +43</div>
                <div data-value="+41">CH +41</div>
                <div data-value="+31">NL +31</div>
                <div data-value="+32">BE +32</div>
                <div data-value="+33">FR +33</div>
                <div data-value="+352">LU +352</div>
                <div data-value="+420">CZ +420</div>
                <div data-value="+48">PL +48</div>
                <div data-value="+45">DK +45</div>
                <div data-value="+1">US +1</div>
              </div>
            </div>
            <input type="hidden" name="countryCode" id="realCountryCode" value="+49" />
          </div>
        </div>
        <div class="form-field full-width">
          <input type="tel" id="phone" placeholder="1234567890" name="fake_phone" autocomplete="off" />
        </div>
      </div>
    </div>
    <div id="validationErrors" class="form-validation-summary"></div>
  </div>
</div>

<!-- ===================================== -->
<!-- Schritt 2: Zimmerdetails -->
<!-- ===================================== -->
  <div id="room-details" class="room-details custom-progress-container" style="display: none;">
    <div class="form-group full">
      <label for="roomSelect">Raum wählen *</label>
      <div class="custom-select-wrapper wide">
      <div class="custom-select" id="customRoomSelect">

        <div class="selected-option">
          <span class="selected-text">Bitte wählen...</span>
          <span class="dropdown-icon">▾</span>
        </div>
        <div class="options-list hidden">
          <div data-value="Wohnzimmer">Wohnzimmer</div>
          <div data-value="Schlafzimmer">Schlafzimmer</div>
          <div data-value="Küche">Küche</div>
          <div data-value="Badezimmer">Badezimmer</div>
          <div data-value="Sonstiges">Sonstiges</div>
        </div>
      </div>
      <input type="hidden" id="roomSelect" name="roomSelect" value="" />
    </div>
  </div>

  <div class="form-group full">
    <label for="roomSize">Quadratmeter *</label>
    <input type="text" id="roomSize" placeholder="z. B. 25" pattern="\d*" inputmode="numeric" autocomplete="off"/>
    <span class="validation-message" id="roomSizeValidation">Bitte geben Sie eine gültige Quadratmeterzahl ein.</span>
  </div>

    <h3 class="materials-heading">Materialvorschläge *</h3>
    <div class="material-grid">
      <div class="material-card">
        <img src="https://media.istockphoto.com/id/1318680899/de/foto/leichter-naturholzhintergrund.jpg?s=2048x2048&w=is&k=20&c=BxLs3us-4r5dHJVGdy7fRtUBdd3TFaQXxlF91vW14zs=" alt="Holzboden" />
        <strong>Holzboden</strong>
        <p>Klassisch und langlebig</p>
      </div>
      <div class="material-card">
        <img src="https://media.istockphoto.com/id/946593026/de/vektor/vektor-wei%C3%9Fen-modernen-abstrakten-hintergrund.jpg?s=2048x2048&w=is&k=20&c=fesT_EAHphSvTx7HBSUP8MzZkkzstcQVhxWltB36e1c=" alt="Fliese" />
        <strong>Fliesen</strong>
        <p>Elegant und wasserfest</p>
      </div>
      <div class="material-card">
        <img src="https://media.istockphoto.com/id/2138862337/de/foto/carpet.jpg?s=2048x2048&w=is&k=20&c=p42TW4njRY436DDwTwm33PWMNlgbcsez5r6fFBi5GgE=" alt="Teppich" />
        <strong>Teppich</strong>
        <p>Weich und schallabsorbierend</p>
      </div>
      <div class="material-card">
        <img src="https://media.istockphoto.com/id/185250199/de/foto/h%C3%B6lzerne-hintergrund.jpg?s=2048x2048&w=is&k=20&c=fm0-yurZ419FBpf-GZ_Qxgm6yZuEOkcykam9NbDXl4M=" alt="Laminat" />
        <strong>Laminat</strong>
        <p>Vielseitig und pflegeleicht</p>
      </div>
      <div class="material-card">
        <img src="https://media.istockphoto.com/id/2155668586/de/foto/schwarze-matte-kunststoffmaterialstruktur.jpg?s=2048x2048&w=is&k=20&c=e_pF9EQ3zkKR5h2LZdX286mnGYtwVACn8ywU0gPlBeo=" alt="Vinyl" />
        <strong>Vinyl</strong>
        <p>Wasserfest und einfach zu reinigen</p>
      </div>
    </div>

    <div id="step2ValidationErrors" class="form-validation-summary"></div>

    <button type="button" id="addRoomButton" class="start-button" style="margin-bottom: 20px;">Hinzufügen</button>

      <div id="roomList" class="room-list"></div>
  </div>
  
<!-- ===================================== -->
<!-- Schritt 3: Bilder hochladen -->
<!-- ===================================== -->
  <div id="image-upload" class="image-upload custom-progress-container" style="display: none;">
    <div id="drop-zone" class="drop-zone">
      <p><strong>Ziehe deine Bilder hierher</strong><br />oder klicke zum Durchsuchen</p>
      <input type="file" id="file-input" accept=".pdf,image/jpeg,image/jpg" multiple hidden />
      <button type="button" id="upload-button" class="start-button">Hochladen</button>
    </div>

    <div class="uploaded-images">
      <h4>Hochgeladene Bilder</h4>
      <div id="gallery" class="gallery"></div>
    </div>
  </div>
  
<!-- ===================================== -->
<!-- Schritt 4: Zusammenfassung -->
<!-- ===================================== -->
<div id="review-summary" class="review-summary custom-progress-container" style="display: none;">
  <div class="review-section">
    <h4 style="display: flex; align-items: center; justify-content: space-between;">
        Persönliche Daten
      <div class="tooltip-container">
        <button class="edit-button" onclick="goToStep(1)">
        <svg xmlns="http://www.w3.org/2000/svg" height="20" viewBox="0 0 24 24" width="20" fill="#FAFAF8">
        <path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04a1.003 1.003 0 0 0 0-1.41l-2.34-2.34a1.003 1.003 0 0 0-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"/>
  </svg>
</button>

      <span class="tooltip-text">Bearbeiten</span>
    </div>
    </h4>

    <ul>
      <li><strong>Vorname:</strong> <span id="summaryFirstName"></span></li>
      <li><strong>Nachname:</strong> <span id="summaryLastName"></span></li>
      <li><strong>E-Mail:</strong> <span id="summaryEmail"></span></li>
      <li><strong>Telefonnummer:</strong> <span id="summaryPhone"></span></li>
    </ul>
  </div>

  <div class="review-section">
    <h4 style="display: flex; align-items: center; justify-content: space-between;">
        Zimmerdetails
        <div class="tooltip-container">
          <button class="edit-button" onclick="goToStep(2)">
            <svg xmlns="http://www.w3.org/2000/svg" height="20" viewBox="0 0 24 24" width="20" fill="#FAFAF8">
          <path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04a1.003 1.003 0 0 0 0-1.41l-2.34-2.34a1.003 1.003 0 0 0-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"/>
          </svg>
        </button>

        <span class="tooltip-text">Bearbeiten</span>
      </div>
    </h4>
    <ul>
      <li><span id="summaryRoom"></span></li>
      <li><span id="summaryMaterial"></span></li>
    </ul>
  </div>

  <div class="review-section">
    <h4 style="display: flex; align-items: center; justify-content: space-between;">
        Hochgeladene Bilder
      <div class="tooltip-container">
        <button class="edit-button" onclick="goToStep(3)">
          <svg xmlns="http://www.w3.org/2000/svg" height="20" viewBox="0 0 24 24" width="20" fill="#FAFAF8">
            <path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04a1.003 1.003 0 0 0 0-1.41l-2.34-2.34a1.003 1.003 0 0 0-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"/>
          </svg>
        </button>
        <span class="tooltip-text">Bearbeiten</span>
      </div>
    </h4>
    <div id="summaryGallery" class="gallery"></div>
  </div>

  
</div>

<!-- ===================================== -->
<!-- Schritt 5: Ergbnis Anzeige nach Absenden -->
<!-- ===================================== -->
  <div id="floating-submit-button" class="submit-button-wrapper" style="display: none;">
    <div class="center-enforcer">
      <button id="submit-button" class="submit-button">
        <span class="submit-text">Absenden</span>
        <span class="submit-icon">
          <div class="loader --1" style="display: none;"></div>
        </span>
      </button>
      <div id="submit-validation-error" style="color: #e74c3c; font-size: 14px; margin-top: 12px; display: none;"></div>
    </div>
  </div>

  <div id="success-screen" class="final-screen" style="display: none;">
    <h2>Anfrage erfolgreich übermittelt</h2>
    <p>Ihre Anfrage wurde erfolgreich übermittelt und wird nun bearbeitet. Sie erhalten eine Benachrichtigung, sobald sie abgeschlossen ist.</p>
    <button onclick="restartForm()" class="success-btn">Zurück zur Startseite</button>
  </div>

  <div id="error-screen" class="final-screen" style="display: none;">
    <h2>Es ist ein Fehler aufgetreten</h2>
    <p>Ein unerwarteter Fehler ist aufgetreten. Bitte versuchen Sie es erneut.</p>
    <button onclick="restartForm()" class="error-btn alt">Zur Startseite</button>
    <button onclick="retrySubmission()" class="error-btn">Erneut versuchen</button>
  </div>
    <button id="start-button" class="start-button" disabled>Weiter</button>
  <style>
 /* ===================================== */
/* Global Styles */
/* ===================================== */

@import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');

* {
  font-family: 'Inter', sans-serif;
}

body {
  background-color: transparent;
  margin: 0;
  padding: 0;
}

input:-webkit-autofill,
input:-webkit-autofill:hover,
input:-webkit-autofill:focus,
input:-webkit-autofill:active {
  -webkit-box-shadow: 0 0 0px 1000px rgba(0, 0, 0, 0.2) inset !important;
  -webkit-text-fill-color: #fff !important;
  caret-color: #fff !important;
  border: none !important;
  transition: background-color 9999s ease-out, color 9999s ease-out;
  animation: none !important;
}

input,
select {
  border: none;
  border-bottom: 2px solid #ccc;
  padding: 10px 4px 6px 4px;
  font-size: 16px;
  background-color: rgba(0, 0, 0, 0.2);
  color: #fff;
  outline: none;
  transition: border-color 0.3s, box-shadow 0.3s;
}

input.touched.valid {
  border-bottom: 2px solid transparent !important;
  background-image: linear-gradient(120deg, #ffffff 20%, #e6e6e6 50%, #ffffff 80%);
  background-repeat: no-repeat;
  background-size: 100% 2px;
  background-position: 0 100%;
}

input.touched.invalid {
  border-bottom: 2px solid #e74c3c !important;
}

input::placeholder {
  color: #fff;
  opacity: 1;
}

input.touched.valid:-webkit-autofill {
  background-color: transparent !important;
  border: none !important;
  background-image: linear-gradient(120deg, #ffffff 20%, #e6e6e6 50%, #ffffff 80%);
  background-repeat: no-repeat;
  background-size: 100% 2px;
  background-position: 0 100%;
}

select {
  appearance: none;
  background-color: transparent;
  color: #fff;
  border-bottom: 2px solid #ccc;
  background-image: url("data:image/svg+xml;utf8,<svg fill='white' height='16' viewBox='0 0 24 24' width='16' xmlns='http://www.w3.org/2000/svg'><path d='M7 10l5 5 5-5z'/></svg>");
  background-repeat: no-repeat;
  background-position: right 8px center;
  background-size: 16px 16px;
  width: 100%;
}

.options-list::-webkit-scrollbar {
  width: 8px;
  height: 8px;
}

.options-list::-webkit-scrollbar-track {
  background: transparent;
}

.options-list::-webkit-scrollbar-thumb {
  background-color: #FAFAF8;
  border-radius: 4px;
  border: none;
}

.options-list::-webkit-scrollbar-button {
  display: none;
}

.options-list::-webkit-scrollbar-corner {
  background: transparent;
}

.options-list {
  scrollbar-width: thin;
  scrollbar-color: #FAFAF8 transparent;
}

.material-icons {
  font-family: 'Material Icons';
  font-style: normal;
  font-weight: normal;
  font-size: 28px;
  line-height: 1;
  letter-spacing: normal;
  text-transform: none;
  display: inline-block;
  white-space: nowrap;
  direction: ltr;
  -webkit-font-feature-settings: 'liga';
  -webkit-font-smoothing: antialiased;
  color: white;
}

/* ===================================== */
/* Schritt 1: Persönliche Daten */
/* ===================================== */

.custom-progress-container {
  max-width: 600px;
  margin: 0 auto;
  padding: 40px 20px;
}

.step-label {
  font-size: 18px;
  font-weight: bold;
  margin-bottom: 6px;
  text-align: center;
  color: #fff;
}

.progress {
  width: 100%;
  height: 8px;
  background-color: #333;
  border-radius: 20px;
  margin-bottom: 30px;
  position: relative;
}

.progress-bar {
  height: 100%;
  width: 25%;
  border-radius: 20px;
  background-image: linear-gradient(120deg, #ffffff 10%, #999999 50%, #ffffff 90%);
  box-shadow: 0 0 12px rgba(255,255,255,0.2);
  background-size: 200% 100%;
  background-position: -100% 0;
  animation: shimmer-progress-bar 5s linear infinite;
  box-shadow: 0 0 20px #ffffff88, 0 0 10px #ffffff55;
}

@keyframes shimmer-progress-bar {
  0% { background-position: -100% 0; }
  50% { background-position: 100% 0; }
  100% { background-position: -100% 0; }
}

.step-heading {
  text-align: center;
  font-size: 20px;
  font-weight: bold;
  color: #fff;
}

.info-label {
  font-size: 14px;
  color: #fff; 
  text-align: center;
}

.form-fields {
  margin-bottom: 30px;
}

.form-row {
  display: flex;
  gap: 20px;
  flex-wrap: wrap;
}

.form-group {
  flex: 1;
  display: flex;
  flex-direction: column;
  margin-bottom: 20px;
}

.form-group.full {
  width: 100%;
}

.form-group label {
  font-weight: bold;
  margin-bottom: 6px;
}

.phone-input-group {
  display: flex;
  gap: 12px;
  align-items: flex-end;
}

.phone-input-group .form-field.full-width {
  flex: 1;
  display: flex;
}

.phone-input-group .form-field.full-width input {
  width: 100%;
}

.phone-input-group.invalid .form-field.like-input {
  border-bottom: 2px solid #e74c3c !important;
}

.phone-input-group.valid .form-field.like-input {
  border-bottom: 2px solid transparent !important;
  background-image: linear-gradient(120deg, #ffffff 20%, #e6e6e6 50%, #ffffff 80%);
  background-repeat: no-repeat;
  background-size: 100% 2px;
  background-position: 0 100%;
}

.phone-input-group .form-field.like-input {
  flex: 0 0 120px;
  display: flex;
  align-items: flex-end;
  border-bottom: 2px solid #ccc;
}

.custom-select-wrapper {
  width: 100%;
  position: relative;
}

.custom-select {
  display: flex;
  align-items: center;
  cursor: pointer;
  color: #fff;
  font-size: 16px;
}

.custom-select .selected-option {
  display: flex;
  justify-content: space-between;
  align-items: center;
  height: 40px;
}

.custom-select .dropdown-icon {
  margin-left: 32px;
  color: #fff;
}

.custom-select .options-list {
  position: absolute;
  top: 100%;
  left: 0;
  width: 100%;
  max-height: 160px;
  overflow-y: auto;
  background-color: #111;
  border: 1px solid #333;
  border-radius: 4px;
  z-index: 999;
}

.custom-select .options-list div {
  padding: 10px;
  cursor: pointer;
}

.custom-select .options-list div:hover {
  background-color: #444;
}

.custom-select .options-list.hidden {
  display: none;
}

#firstName,
#lastName,
#phone,
#email,
#roomSize {
  background-color: rgba(0, 0, 0, 0.2) !important;
  color: #fff !important;
}

 .form-vwAmpW5o_b #_builder-form input[type=email],
  .form-vwAmpW5o_b #_builder-form input[type=tel],
  .form-vwAmpW5o_b #_builder-form .multiselect .multiselect__tags {
    background-color: rgba(0, 0, 0, 0.2) !important;
    color: #ffffff !important;
    border-bottom: 2px solid #ccc !important;
    border: none !important;
  }

  input.invalid {
    border-bottom: 2px solid #e74c3c !important;
  }

  input.valid {
    border-bottom: 2px solid transparent !important;
    background-image: linear-gradient(120deg, #ffffff 20%, #e6e6e6 50%, #ffffff 80%);
    background-repeat: no-repeat;
    background-size: 100% 2px;
    background-position: 0 100%;
  }

/* ===================================== */
/* Schritt 2: Zimmerdetails */
/* ===================================== */

.room-details {
  margin-top: 20px;
}

.materials-heading {
  margin-bottom: 24px !important;
  font-size: 18px;
  font-weight: bold;
}

.material-grid {
  display: flex;
  flex-wrap: wrap;
  gap: 20px;
  justify-content: space-between;
}

.material-card {
  flex: 1 1 120px;
  max-width: 150px;
  text-align: center;
  padding: 10px;
  border: 2px solid transparent;
  border-radius: 12px;
  cursor: pointer;
  background-image:
    linear-gradient(#000, #000),
    linear-gradient(135deg, #a47148 40%, #FAFAF8 50%, #F1F1F1 60%);
  background-origin: border-box;
  background-clip: padding-box, border-box;
  transition: all 0.2s ease;
}

.material-card:hover {
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
}

.material-card.selected {
  border-color: #FAFAF8;
  background: linear-gradient(135deg, #1e1e1e, #000);
  box-shadow: 0 0 8px #FAFAF8aa;
  transform: scale(1.02);
}

.material-card img {
  width: 100%;
  border-radius: 6px;
  margin-bottom: 8px;
}

.material-card p {
  font-size: 13px;
  color: #555;
}

.custom-select-wrapper.wide {
  border-bottom: 2px solid #ccc;
  padding-bottom: 4px;
}

.custom-select-wrapper.wide.valid {
  border-bottom: 2px solid transparent;
  background-image: linear-gradient(120deg, #ffffff 20%, #e6e6e6 50%, #ffffff 80%);
  background-repeat: no-repeat;
  background-size: 100% 2px;
  background-position: 0 100%;
}

.custom-select-wrapper.wide.invalid {
  border-bottom: 2px solid #e74c3c;
}

#roomSize{
  background-color: rgba(0, 0, 0, 0.2) !important;
  color: #fff !important;
}

label[for="roomSelect"],
label[for="roomSize"],
.materials-heading {
  color: #fff !important;
}

#roomList table {
  color: #fff;
  background-color: transparent;
  border-collapse: collapse;
  width: 100%;
}

#roomList th,
#roomList td {
  border-bottom: 1px solid #777;
  padding: 8px;
}

#roomList th {
  font-weight: bold;
  color: #fff;
}

#roomList tr:hover {
  background-color: rgba(255, 255, 255, 0.05);
}


/* ===================================== */
/* Schritt 3: Bild-Upload */
/* ===================================== */

.image-upload {
  margin-top: 30px;
}

.drop-zone {
  position: relative;
  padding: 40px;
  text-align: center;
  cursor: pointer;
  margin-bottom: 30px;
  z-index: 1;
  background-color: transparent;
}

.drop-zone::before {
  content: "";
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background:
    repeating-linear-gradient(to right, #FAFAF8 0, #F1F1F1 8px, transparent 8px, transparent 16px),
    repeating-linear-gradient(to bottom, #FAFAF8 0, #F1F1F1 8px, transparent 8px, transparent 16px),
    repeating-linear-gradient(to left, #FAFAF8 0, #F1F1F1 8px, transparent 8px, transparent 16px),
    repeating-linear-gradient(to top, #FAFAF8 0, #F1F1F1 8px, transparent 8px, transparent 16px);
  background-repeat: no-repeat;
  background-size:
    100% 2px,
    2px 100%,
    100% 2px,
    2px 100%;
  background-position:
    top left,
    top right,
    bottom left,
    top left;
  pointer-events: none;
  z-index: 2;
}

.drop-zone:hover {
  background-color: #111;
}

.uploaded-images h4 {
  margin-bottom: 10px;
}

.gallery {
  display: flex;
  gap: 20px;
  flex-wrap: wrap;
}

.gallery img {
  width: 160px;
  border-radius: 10px;
  object-fit: cover;
  box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
}

#image-upload h4,
#image-upload h3,
#image-upload p,
#drop-zone p {
  color: #fff !important;
}

#drop-zone p strong {
  color: #fff !important;
}


/* ===================================== */
/* Schritt 4: Zusammenfassung */
/* ===================================== */

.review-summary {
  margin-top: 30px;
}

.review-section {
  margin-bottom: 30px;
}

.review-section h4 {
  display: flex;
  align-items: center;
  justify-content: space-between;
  font-size: 16px;
  margin-bottom: 10px;
}

.review-section ul {
  list-style: none;
  padding: 0;
  margin: 0;
}

.review-section ul li {
  padding: 4px 0;
  font-size: 14px;
}

.edit-button {
  background: none;
  border: none;
  font-size: 18px;
  cursor: pointer;
  color: #FAFAF8;
  padding: 4px;
  filter: drop-shadow(0 0 3px #FAFAF8);
  transition: transform 0.2s ease;
}

.edit-button:hover {
  transform: scale(1.15);
  text-shadow: 0 0 6px #FAFAF8;
}


.tooltip-container {
  position: relative;
  display: inline-block;
}

.tooltip-text {
  visibility: hidden;
  background-color: #000;
  color: #fff;
  border-radius: 6px;
  padding: 4px 8px;
  font-size: 12px;
  position: absolute;
  top: -5px;
  right: 130%;
  white-space: nowrap;
  opacity: 0;
  transition: opacity 0.3s;
}

.tooltip-container:hover .tooltip-text {
  visibility: visible;
  opacity: 1;
}

#review-summary {
  margin-top: 0 !important;
  padding-top: 0 !important;
}

#review-summary .review-section:first-of-type {
  margin-top: 0 !important;
}

.review-summary .info-label {
  margin-bottom: 10px !important;
}

#review-summary h4,
#review-summary span,
#review-summary li,
#review-summary th,
#review-summary td {
  color: #fff !important;
}

#review-summary table {
  color: #fff;
  border-collapse: collapse;
  width: 100%;
  background-color: transparent;
}

#review-summary th,
#review-summary td {
  border-bottom: 1px solid #fff;
  padding: 8px;
}

#review-summary tr:hover {
  background-color: rgba(255, 255, 255, 0.05);
}

.submit-container {
  text-align: center;
  display: flex;
  justify-content: center;
  align-items: center;
  margin: 0 auto;
}

.loader {
  --color: white;
  --size-mid: 24px;
  --size-dot: 6px;
  --size-bar: 2px;
  --size-square: 16px;

  display: block;
  position: relative;
  width: 50%;
  display: grid;
  place-items: center;
}

.loader::before,
.loader::after {
  content: '';
  box-sizing: border-box;
  position: absolute;
}

/* Loader Style --1 */
.loader.--1::before {
  width: var(--size-mid);
  height: var(--size-mid);
  border: 4px solid var(--color);
  border-top-color: transparent;
  border-radius: 50%;
  animation: loader-1 1s linear infinite;
}

.loader.--1::after {
  width: calc(var(--size-mid) - 2px);
  height: calc(var(--size-mid) - 2px);
  border: 2px solid transparent;
  border-top-color: var(--color);
  border-radius: 50%;
  animation: loader-1 0.6s linear reverse infinite;
}

@keyframes loader-1 {
  100% {
    transform: rotate(1turn);
  }
}
.submit-icon .loader {
  width: 100%;
  height: 100%;
  display: flex;
  align-items: center;
  justify-content: center;
}


/* ===================================== */
/* Schritt 5: Ergbnis Anzeige nach Absenden*/
/* ===================================== */

.final-screen {
  text-align: center;
  padding: 40px 20px;
  color: white;
  max-width: 600px;
  margin: 0 auto;
}

.progress-bar-final {
  width: 100%;
  height: 8px;
  background-color: #333;
  border-radius: 20px;
  margin: 20px 0;
}

.progress-full {
  height: 100%;
  width: 100%;
  background: linear-gradient(to right, #FAFAF8, #F1F1F1);
  border-radius: 20px;
  box-shadow: 0 0 10px #FAFAF866;
}

.success-btn, .error-btn {
  margin: 10px 5px 0;
  padding: 12px 24px;
  font-size: 16px;
  border-radius: 8px;
  cursor: pointer;
  font-weight: bold;
  transition: background 0.3s ease;
}

.success-btn {
  background-color: transparent !important;
  color: #fff !important;
  padding: 12px 24px;
  font-size: 16px;
  font-weight: bold;
  border: 2px solid transparent;
  border-radius: 8px;
  cursor: pointer;
  position: relative;
  z-index: 1;
  background-clip: padding-box;
  box-shadow: none !important;
}

.success-btn::before {
  content: "";
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  border-radius: 8px;
  padding: 2px;
  background: linear-gradient(to right, #FAFAF8, #F1F1F1);
  -webkit-mask:
    linear-gradient(#fff 0 0) content-box,
    linear-gradient(#fff 0 0);
  -webkit-mask-composite: xor;
  mask-composite: exclude;
  pointer-events: none;
  z-index: -1;
}

.error-btn {
  background: linear-gradient(to right, #FAFAF8, #F1F1F1);
  border: none;
}

.error-btn.alt {
  background: #333;
  color: #fff;
}

.success-btn,
.error-btn,
.error-btn.alt {
  color: white !important;
}

.success-btn {
  background: transparent !important;
  box-shadow: none !important;
}

/* ===================================== */
/* Buttons */
/* ===================================== */

.start-button {
  display: block;
  margin: 30px auto 0 auto;
  padding: 12px 24px;
  font-size: 16px;
  background: transparent;
  color: #FAFAF8;
  border: 2px solid transparent;
  border-image-source: linear-gradient(120deg, #ffffff 30%, #e5e5e5 50%, #ffffff 70%);
  border-image-slice: 1;
  border-radius: 8px;
  cursor: pointer;
  transition: all 0.3s ease;
  animation: shimmer-border 4s ease-in-out infinite;
}

.start-button:hover:not(:disabled) {
  background-color: rgba(255, 215, 0, 0.05);
  box-shadow: 0 0 8px #FAFAF8aa;
}

.start-button:disabled {
  opacity: 0.3;
  border-color: #555;
  color: #999;
  cursor: not-allowed;
  border-image: none;
}

@keyframes shimmer-border {
  0% {
    border-image-source: linear-gradient(120deg, #FAFAF8 30%, #F1F1F1 50%, #FAFAF8 70%);
  }
  50% {
    border-image-source: linear-gradient(120deg, #FAFAF8 10%, #fff2b0 50%, #FAFAF8 90%);
  }
  100% {
    border-image-source: linear-gradient(120deg, #FAFAF8 30%, #F1F1F1 50%, #FAFAF8 70%);
  }
}

.form-validation-summary {
  color: #e74c3c; 
  font-size: 14px;
  margin-top: 8px;
  font-weight: 500;
}

.submit-button {
  position: relative;
  width: 200px;
  height: 56px;
  margin: 0 auto;
  border: 2px solid transparent;
  border-radius: 28px;
  background-color: transparent !important;
  color: #FAFAF8;
  font-weight: bold;
  font-size: 16px;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  overflow: hidden;
  z-index: 1;
  background-clip: padding-box;
  box-shadow: none !important;
  transition: all 0.4s ease-in-out;
  animation: shimmer-border 5s ease-in-out infinite;
}

.submit-button.expanding::before {
  content: "";
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  border-radius: 50%;
  padding: 2px;
  background: linear-gradient(120deg, #FAFAF8 20%, #F1F1F1 50%, #FAFAF8 80%);
  background-size: 200% 100%;
  background-position: -100% 0;
  animation: shimmer-border 2s ease-in-out infinite;
  z-index: -1;
  pointer-events: none;
  -webkit-mask:
    linear-gradient(#fff 0 0) content-box,
    linear-gradient(#fff 0 0);
  -webkit-mask-composite: xor;
  mask-composite: exclude;
}

.submit-button::before {
  content: "";
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  border: 3px solid #FAFAF8;
  border-radius: 28px;
  padding: 3px;
  background: linear-gradient(120deg, #ffffff 20%, #eaeaea 50%, #ffffff 80%);
  box-shadow: 0 0 12px rgba(255,255,255,0.25);
  background-size: 200% 100%;
  background-position: -100% 0;
  animation: shimmer-border 2s ease-in-out infinite;
  pointer-events: none;
  z-index: -1;
  -webkit-mask:
    linear-gradient(#fff 0 0) padding-box,
    linear-gradient(#fff 0 0);
  -webkit-mask-composite: xor;
  mask-composite: exclude;
}

.submit-button.success {
  background-color: #FAFAF8;
  color: black;
  border-color: #FAFAF8;
}

.submit-button.error {
  background-color: #e74c3c;
  color: white;
  border-color: #e74c3c;
}

.submit-button-wrapper {
  width: 100%;
  display: flex;
  justify-content: center !important;
  align-items: center;
  margin: 40px auto 20px auto;
  position: relative;
  z-index: 10;
}

.center-enforcer {
  display: flex !important;
  justify-content: center !important;
  width: 100% !important;
  max-width: 100% !important;
}


.submit-text,
.submit-icon {
  position: absolute;
  transition: opacity 0.3s ease;
}

.submit-icon {
  position: absolute;
  transition: opacity 0.3s ease;
  display: flex;
  align-items: center;
  justify-content: center;
  width: 100%;
  height: 100%;
}

.submit-icon .material-icons {
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 28px;
  width: 100%;
  height: 100%;
}

.submit-button.expanding {
  width: 64px;
  height: 64px;
  border-radius: 50%;
  padding: 0;
  justify-content: center;
  align-items: center;
  gap: 0;
}

.submit-button.expanding .submit-text {
  opacity: 0;
  pointer-events: none;
}

.submit-button.expanding .submit-icon {
  opacity: 1;
  transform: scale(1.2);
  transition: all 0.3s ease;
}

@keyframes button-expand {
  0% {
    width: 200px;
    height: 56px;
    border-radius: 28px;
    background: #fff;
  }
  20% {
    width: 220px;
    height: 60px;
    background: #fff;
  }
  40% {
    width: 180px;
    height: 56px;
    background: #6fb07f;
  }
  100% {
    width: 64px;
    height: 64px;
    border-radius: 32px;
    background: #6fb07f;
  }
}

.submit-button.expanding {
  gap: 0 !important;
  padding: 0 !important;
}

@keyframes show-icon {
  0% { opacity: 0; transform: scale(0.5); }
  100% { opacity: 1; transform: scale(1.2); }
}

.submit-button.animate .submit-icon,
.submit-button.expanding .submit-icon {
  display: inline-block;
  opacity: 1;
  animation: show-icon 0.3s ease forwards;
}

#floating-submit-button {
  display: flex;
  justify-content: center;
  align-items: center;
  padding-top: 40px;
}

.shimmer-effect {
  background-image: linear-gradient(120deg, #ffffff 20%, #e6e6e6 50%, #ffffff 80%);
  background-size: 200% 100%;
  background-position: -100% 0;
  animation: shimmer-progress-bar 6s ease-in-out infinite;
  box-shadow: 0 0 10px #FAFAF866;
}

</style>

<script>
  let currentStep = 1;
  const maxSteps = 4;

  const phoneGroup = document.querySelector(".phone-input-group");
  const stepNumber = document.getElementById('step-number');
  const progressBar = document.getElementById('progress-bar');
  const stepHeading = document.getElementById('step-heading');
  const startButton = document.getElementById('start-button');
  const submitButton = document.getElementById('submit-button'); 
  const infoLabel = document.getElementById('info-label');
  const countryCode = document.getElementById('countryCode');

  const customSelect = document.getElementById("customCountryCode");
  const selectedOption = customSelect.querySelector(".selected-option");
  const optionsList = customSelect.querySelector(".options-list");
  const realInput = document.getElementById("realCountryCode");
  const selectedText = selectedOption.querySelector(".selected-text");


  const formFields = document.getElementById('personal-form');
  const roomDetails = document.getElementById('room-details');
  const imageUpload = document.getElementById('image-upload');
  const reviewSummary = document.getElementById('review-summary');

  const firstName = document.getElementById('firstName');
  const lastName = document.getElementById('lastName');
  const email = document.getElementById('email');
  const phone = document.getElementById('phone');

  const roomSelect = document.getElementById('roomSelect');
  const roomSize = document.getElementById('roomSize');
  const roomSizeValidation = document.getElementById('roomSizeValidation');
  const addRoomButton = document.getElementById('addRoomButton');
  const roomList = document.getElementById('roomList');
  const customRoomWrapper = document.getElementById("customRoomSelect");
  const roomSelectedOption = customRoomWrapper.querySelector(".selected-option");
  const roomOptionsList = customRoomWrapper.querySelector(".options-list");
  const realRoomInput = document.getElementById("roomSelect");
  const roomText = roomSelectedOption.querySelector(".selected-text");
  let selectedRooms = [];
  let selectedMaterial = null;
  let roomDropdownOpen = false;
  let roomTouched = false;
  let sizeTouched = false;
  let materialTouched = false;

  const dropZone = document.getElementById('drop-zone');
  const fileInput = document.getElementById('file-input');
  const gallery = document.getElementById('gallery');
  const uploadButton = document.getElementById('upload-button');

  const summaryFirstName = document.getElementById('summaryFirstName');
  const summaryLastName = document.getElementById('summaryLastName');
  const summaryEmail = document.getElementById('summaryEmail');
  const summaryPhone = document.getElementById('summaryPhone');
  const summaryRoom = document.getElementById('summaryRoom');
  const summaryMaterial = document.getElementById('summaryMaterial');
  const summaryGallery = document.getElementById('summaryGallery');

  const materialCards = document.querySelectorAll('.material-card');

  const iconFontLink = document.createElement("link");
  iconFontLink.href = "https://fonts.googleapis.com/icon?family=Material+Icons";
  iconFontLink.rel = "stylesheet";
  document.head.appendChild(iconFontLink);

  if (currentStep === 1) {
  document.getElementById('step-heading').style.display = 'none';
  document.getElementById('info-label').style.display = 'none';
}

  materialCards.forEach(card => {
    card.addEventListener('click', () => {
      const isSelected = card.classList.contains('selected');
      materialCards.forEach(c => c.classList.remove('selected'));
      if (!isSelected) {
        card.classList.add('selected');
        selectedMaterial = card.querySelector('strong')?.innerText || null;
      } else {
        selectedMaterial = null;
      }
      validateStep2();
    });
  });

  const headings = [
    "Willkommen",
    "Zimmerdetails",  
    "Bilder hochladen",    
    "Anfrage überprüfen"     
  ];

  const customWrapper = document.querySelector('.form-field.like-input');

  let isDropdownOpen = false;

  customWrapper.addEventListener("click", (e) => {
    e.stopPropagation();
    isDropdownOpen = !isDropdownOpen;

    optionsList.classList.toggle("hidden", !isDropdownOpen);
    selectedOption.classList.toggle("open", isDropdownOpen);
  });

    optionsList.querySelectorAll("div").forEach(option => {
    option.addEventListener("click", (e) => {
      e.stopPropagation();

      const value = option.dataset.value;
      selectedText.textContent = option.textContent;
      realInput.value = value;

      isDropdownOpen = false;
      optionsList.classList.add("hidden");
      selectedOption.classList.remove("open");
    });
  });

  // Click outside to close
  document.addEventListener("click", (e) => {
    if (!customSelect.contains(e.target)) {
      optionsList.classList.add("hidden");
      selectedOption.classList.remove("open");
    }
  });

  // Schritt 1 validieren
function validateStep1() {
  const errors = [];
  let isValid = true;

  const nameRegex = /^[A-Za-zÄÖÜäöüß\s-]{2,}$/;
  const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;

  // Vorname
  if (firstName.classList.contains("touched")) {
    if (!nameRegex.test(firstName.value.trim())) {
      markInvalid(firstName);
      errors.push("Bitte geben Sie einen gültigen Vornamen ein.");
      isValid = false;
    } else {
      markValid(firstName);
    }
  }

  // Nachname
  if (lastName.classList.contains("touched")) {
    if (!nameRegex.test(lastName.value.trim())) {
      markInvalid(lastName);
      errors.push("Bitte geben Sie einen gültigen Nachnamen ein.");
      isValid = false;
    } else {
      markValid(lastName);
    }
  }

  // E-Mail
  if (email.classList.contains("touched")) {
    if (!emailRegex.test(email.value.trim())) {
      markInvalid(email);
      errors.push("Bitte geben Sie eine gültige E-Mail-Adresse ein.");
      isValid = false;
    } else {
      markValid(email);
    }
  }

  // Telefonnummer
  if (phone.classList.contains("touched")) {
    if (!/^\d{5,}$/.test(phone.value.trim())) {
      markInvalid(phone);
      phoneGroup.classList.remove("valid");
      phoneGroup.classList.add("invalid");
      errors.push("Bitte geben Sie eine gültige Telefonnummer ein (mind. 5 Ziffern).");
      isValid = false;
    } else {
      markValid(phone);
      phoneGroup.classList.remove("invalid");
      phoneGroup.classList.add("valid");
    }
  }

  // Fehler nur anzeigen, wenn mindestens ein Feld touched wurde
  const touchedFields = [firstName, lastName, email, phone].some(el => el.classList.contains("touched"));
  const errorContainer = document.getElementById("validationErrors");
  errorContainer.innerHTML = touchedFields ? errors.map(err => `<div>• ${err}</div>`).join("") : "";

  // Startbutton aktivieren, wenn alles gültig ist
  startButton.disabled = !(
      nameRegex.test(firstName.value.trim()) &&
      nameRegex.test(lastName.value.trim()) &&
      emailRegex.test(email.value.trim()) &&
      /^\d{5,}$/.test(phone.value.trim())
    );
  }

function markInvalid(input) {
  input.classList.remove("valid");
  input.classList.add("invalid");
}

function markValid(input) {
  input.classList.remove("invalid");
  input.classList.add("valid");
}

 // Event-Handler für Schritt 1
[firstName, lastName, email, phone].forEach(input => {
  input.addEventListener("blur", () => {
    input.classList.add("touched");
    validateStep1();
  });

  input.addEventListener("input", () => {
    validateStep1();
  });
});

 // Schritt 2 validieren
function validateStep2() {
  const errors = [];
  const isRoomSelected = roomSelect.value !== '';
  const sizeValid = parseInt(roomSize.value) > 0;
  const hasMaterial = selectedMaterial !== null;

  // Linie beim Raumfeld (Dropdown)
  const roomWrapper = document.querySelector('.custom-select-wrapper.wide');
  if (!isRoomSelected && roomTouched) {
    roomWrapper.classList.remove("valid");
    roomWrapper.classList.add("invalid");
  } else if (roomTouched) {
    roomWrapper.classList.remove("invalid");
    roomWrapper.classList.add("valid");
  }

  // Linie beim Quadratmeterfeld
  if (!sizeValid && sizeTouched) {
    roomSize.classList.remove("valid");
    roomSize.classList.add("invalid");
  } else if (sizeTouched) {
    roomSize.classList.remove("invalid");
    roomSize.classList.add("touched", "valid");
  }

  // Material-Auswahl aktivieren/deaktivieren
  const enableMaterials = isRoomSelected && sizeValid;
  materialCards.forEach(card => {
    card.style.pointerEvents = enableMaterials ? "auto" : "none";
    card.style.opacity = enableMaterials ? "1" : "0.5";
  });

  // Fehlermeldungen sammeln
  if (!isRoomSelected && roomTouched) errors.push("Bitte wählen Sie einen Raum aus.");
  if (!sizeValid && sizeTouched) errors.push("Bitte geben Sie eine gültige Quadratmeterzahl ein.");
  if (!hasMaterial && materialTouched) errors.push("Bitte wählen Sie ein Material aus.");

  // Fehlermeldungen anzeigen
  document.getElementById("step2ValidationErrors").innerHTML = errors.length > 0
    ? errors.map(msg => `<div>• ${msg}</div>`).join("")
    : "";

  // Buttons aktivieren
  addRoomButton.disabled = !(isRoomSelected && sizeValid && hasMaterial);
  startButton.disabled = !(selectedRooms.length > 0);
}

  customRoomWrapper.addEventListener("click", (e) => {
    e.stopPropagation();
    roomDropdownOpen = !roomDropdownOpen;
    roomOptionsList.classList.toggle("hidden", !roomDropdownOpen);
    roomSelectedOption.classList.toggle("open", roomDropdownOpen);
  });

  roomOptionsList.querySelectorAll("div").forEach(option => {
    option.addEventListener("click", (e) => {
      e.stopPropagation();
      const value = option.dataset.value;
      roomText.textContent = value;
      realRoomInput.value = value;

      roomTouched = true;

      roomDropdownOpen = false;
      roomOptionsList.classList.add("hidden");
      roomSelectedOption.classList.remove("open");
      validateStep2();
    });
  });

  roomSize.addEventListener("input", () => {
    sizeTouched = true;
    validateStep2();
  });

  materialCards.forEach(card => {
    card.addEventListener('click', () => {
      materialTouched = true;
      validateStep2();
    });
  });

  document.addEventListener("click", (e) => {
    if (!customRoomWrapper.contains(e.target)) {
      roomOptionsList.classList.add("hidden");
      roomSelectedOption.classList.remove("open");
      roomDropdownOpen = false;
    }
  });

// Initial deaktivieren
addRoomButton.disabled = true;
roomSizeValidation.style.display = 'none';

roomSelect.addEventListener("change", validateStep2);
roomSize.addEventListener("input", validateStep2);

// Events anpassen (z. B. nach Materialauswahl validieren)
addRoomButton.addEventListener("click", () => {
  const room = roomSelect.value;
  const size = roomSize.value;
  const material = selectedMaterial;

  if (room && parseInt(size) > 0 && material) {
    const roomKeyRaw = room.toLowerCase().replace('ä', 'ae').replace('ö', 'oe').replace('ü', 'ue');

    const fieldMap = {
      wohnzimmer: 'living_room',
      schlafzimmer: 'bed_room',
      badezimmer: 'bathroom',
      kueche: 'kitchen'
    };

    const mappedRoom = fieldMap[roomKeyRaw]; 

    selectedRooms = selectedRooms.filter(r => r.roomLabel !== room);

    // Speichern – mit oder ohne API-Schlüssel
    selectedRooms.push({
      roomKey: mappedRoom || null,
      roomLabel: room,
      size,
      material
    });

    // UI zurücksetzen
    roomSelect.value = '';
    roomSize.value = '';
    selectedMaterial = null;
    materialCards.forEach(c => c.classList.remove('selected'));
    roomSize.classList.remove("valid", "invalid", "touched");

    roomTouched = false;
    sizeTouched = false;
    materialTouched = false;

    validateStep2();
    updateRoomList();
  }
});

function updateRoomList() {
  roomList.innerHTML = '';

  if (selectedRooms.length === 0) return;

  const table = document.createElement('table');
  table.style.width = '100%';
  table.style.borderCollapse = 'collapse';
  table.style.marginTop = '10px';

  const headerRow = document.createElement('tr');
  ['Raum', 'Größe', 'Material'].forEach(text => {
    const th = document.createElement('th');
    th.textContent = text;
    th.style.borderBottom = '1px solid #ccc';
    th.style.textAlign = 'left';
    th.style.padding = '6px';
    headerRow.appendChild(th);
  });
  table.appendChild(headerRow);

  selectedRooms.forEach(entry => {
  const row = document.createElement('tr');
    [entry.roomLabel, `${entry.size} m²`, entry.material].forEach(val => {
      const td = document.createElement('td');
      td.textContent = val;
      td.style.padding = '6px';
      row.appendChild(td);
    });
    table.appendChild(row);
  });
  roomList.appendChild(table);
}

  // Weiter-Button (Schritt 1–3)
  startButton.addEventListener("click", () => {
    if ((currentStep === 1 && startButton.disabled) || (currentStep === 2 && startButton.disabled)) {
      return;
    }

    if (currentStep < maxSteps) {
      currentStep++;
      document.querySelector('.custom-progress-container').scrollIntoView({ behavior: 'smooth' });
      stepNumber.textContent = `Schritt ${currentStep}`;
      progressBar.style.width = `${currentStep * 25}%`;
      stepHeading.textContent = headings[currentStep - 1];

      document.getElementById('step-heading').style.display = currentStep === 1 ? 'none' : 'block';
      document.getElementById('info-label').style.display = currentStep === 1 ? 'none' : 'block';

      startButton.style.display = currentStep < maxSteps ? "block" : "none";
      document.getElementById("floating-submit-button").style.display = currentStep === maxSteps ? "block" : "none";

      // Inhalt sichtbar machen
      formFields.style.display = currentStep === 1 ? "block" : "none";
      roomDetails.style.display = currentStep === 2 ? "block" : "none";
      imageUpload.style.display = currentStep === 3 ? "block" : "none";
      reviewSummary.style.display = currentStep === 4 ? "block" : "none";

      if (currentStep === 2) {
        validateStep2();
      } else {
        startButton.disabled = false;
      }

      // Schritt 4 zusammenfassen
     if (currentStep === 4) {

      infoLabel.textContent = "Bitte überprüfen Sie alle Informationen nochmal gründlich.";

      summaryFirstName.textContent = firstName.value;
      summaryLastName.textContent = lastName.value;
      summaryEmail.textContent = email.value;
      summaryPhone.textContent = `${realInput.value} ${phone.value}`;

    // Raum-Übersicht als Tabelle
    summaryRoom.innerHTML = '';
    if (selectedRooms.length > 0) {
      const table = document.createElement('table');
      table.style.width = '100%';
      table.style.borderCollapse = 'collapse';

      const headerRow = document.createElement('tr');
      ['Raum', 'Größe', 'Material'].forEach(text => {
        const th = document.createElement('th');
        th.textContent = text;
        th.style.borderBottom = '1px solid #ccc';
        th.style.textAlign = 'left';
        th.style.padding = '6px';
        headerRow.appendChild(th);
      });
      table.appendChild(headerRow);

      selectedRooms.forEach(entry => {
        const row = document.createElement('tr');
        [entry.roomLabel, `${entry.size} m²`, entry.material].forEach(val => {
          const td = document.createElement('td');
          td.textContent = val;
          td.style.padding = '6px';
          row.appendChild(td);
        });
        table.appendChild(row);
      });

      summaryRoom.appendChild(table);
    } else {
      summaryRoom.textContent = 'Keine Angaben gemacht';
    }

    summaryMaterial.textContent = '';
    summaryGallery.innerHTML = "";

  Array.from(gallery.children).forEach(node => {
    const clone = node.cloneNode(true);
    summaryGallery.appendChild(clone);
  });

  }
    }
  });

  function goToStep(step) {
      if (step < 1 || step > maxSteps) return;

      currentStep = step;
      stepNumber.textContent = `Schritt ${currentStep}`;
      progressBar.style.width = `${currentStep * 25}%`;
      stepHeading.textContent = headings[currentStep - 1];
      document.getElementById('step-heading').style.display = currentStep === 1 ? 'none' : 'block';
      document.getElementById('info-label').style.display = currentStep === 1 ? 'none' : 'block';
      document.querySelector('.custom-progress-container').scrollIntoView({ behavior: 'smooth' });

      formFields.style.display = currentStep === 1 ? "block" : "none";
      roomDetails.style.display = currentStep === 2 ? "block" : "none";
      imageUpload.style.display = currentStep === 3 ? "block" : "none";
      reviewSummary.style.display = currentStep === 4 ? "block" : "none";

      startButton.style.display = currentStep < maxSteps ? "block" : "none";
      document.getElementById("floating-submit-button").style.display = step === maxSteps ? "block" : "none";

      if (currentStep === 1) validateStep1();
      if (currentStep === 2) validateStep2();
  }

  dropZone.addEventListener('dragover', (e) => {
    e.preventDefault();
    dropZone.style.backgroundColor = '#f1f1f1';
  });

  phone.addEventListener("input", () => {
    phone.value = phone.value.replace(/\D/g, "");
   validateStep1();
  });

  dropZone.addEventListener('dragleave', () => {
    dropZone.style.backgroundColor = 'transparent';
  });

  dropZone.addEventListener('drop', (e) => {
    e.preventDefault();
    dropZone.style.backgroundColor = 'transparent';
    handleFiles(e.dataTransfer.files);
  });

  uploadButton.addEventListener('click', () => fileInput.click());

  fileInput.addEventListener('change', () => {
    handleFiles(fileInput.files);
  });

function handleFiles(files) {
  const allowedTypes = ['application/pdf', 'image/jpeg', 'image/jpg'];

  Array.from(files).forEach(file => {
    if (!allowedTypes.includes(file.type)) {
      alert(`Dateiformat nicht erlaubt: ${file.name}`);
      return;
    }

    const reader = new FileReader();
    reader.onload = (e) => {
      const wrapper = document.createElement('div');
      wrapper.style.width = '160px';
      wrapper.style.border = '1px solid #ddd';
      wrapper.style.borderRadius = '10px';
      wrapper.style.overflow = 'hidden';
      wrapper.style.boxShadow = '0 2px 5px rgba(0,0,0,0.1)';
      wrapper.style.background = '#fff';
      wrapper.style.textAlign = 'center';
      wrapper.style.display = 'flex';
      wrapper.style.flexDirection = 'column';
      wrapper.style.justifyContent = 'center';
      wrapper.style.padding = '10px';

      if (file.type === 'application/pdf') {
        const icon = document.createElement('div');
        icon.innerHTML = '📄';
        icon.style.fontSize = '48px';
        icon.style.marginBottom = '8px';

        const filename = document.createElement('div');
        filename.textContent = file.name;
        filename.style.fontSize = '12px';
        filename.style.overflow = 'hidden';
        filename.style.textOverflow = 'ellipsis';
        filename.style.whiteSpace = 'nowrap';

        wrapper.appendChild(icon);
        wrapper.appendChild(filename);
      } else {
        const img = document.createElement('img');
        img.src = e.target.result;
        img.style.width = '100%';
        img.style.height = 'auto';
        img.style.objectFit = 'cover';
        wrapper.appendChild(img);
      }

      gallery.appendChild(wrapper);
    };

    reader.readAsDataURL(file);
  });
}

submitButton.addEventListener("click", async () => {
    const btn = document.getElementById("submit-button");
    const errorDiv = document.getElementById("submit-validation-error");

    btn.classList.remove("success", "error", "animate", "expanding");
    void btn.offsetWidth;
    btn.classList.add("expanding");

    btn.querySelector(".submit-text").style.opacity = "0";

    const icon = btn.querySelector(".submit-icon");
    const loader = btn.querySelector(".loader.--1");
    loader.style.display = "flex";

    let success = false;

    try {
      await loadTokensFromContact();
      await refreshAccessToken();
      await submitToHighLevel();
      success = true;
    } catch (err) {
      console.error("Fehler bei einem der Schritte:", err);
    }

    if (!success) {
      btn.classList.remove("expanding");
    }

    loader.style.display = "none";

  if (success) {
    setTimeout(showSuccessScreen, 1000);
  } else {
    setTimeout(showErrorScreen, 1000);
  }
  });

  let currentAccessToken = ''; 
  let refreshToken = ""; 

  const BearerToken = "Bearer pit-df626d04-ebd5-45d8-8548-d589f9d5c903";

  const TOKEN_ENDPOINT = "https://services.leadconnectorhq.com/oauth/token";
  const clientId = "685737491800a62217430f79-mc6ue3sc";
  const clientSecret = "86f0ba89-a445-46f3-bf34-d1a45d4257d6";
  const contactIdForTokens = "KvRK0ZcbufYtpm2sMmWM";
  const userType = "Location";
  const apiVersion = "2021-07-28";

  async function refreshAccessToken() {
    const formData = new URLSearchParams();
    formData.append("grant_type", "refresh_token");
    formData.append("client_id", clientId);
    formData.append("client_secret", clientSecret); 
    formData.append("refresh_token", refreshToken);
    formData.append("user_type", userType);

    const response = await fetch(TOKEN_ENDPOINT, {
      method: "POST",
      headers: {
        "Content-Type": "application/x-www-form-urlencoded",
        "Version": apiVersion
      },
      body: formData
    });

    const data = await response.json();

    console.log("📨 Response JSON:", data);

    currentAccessToken = `Bearer ${data.access_token}`;
    refreshToken = data.refresh_token;

    await updateTokenStorageContact(currentAccessToken, refreshToken);
    console.log("💾 Tokens erfolgreich gespeichert im Kontakt.");
  }
  
  async function updateTokenStorageContact(access, refresh) {
    const body = {
      firstName: access,
      lastName: refresh
    };

    const url = `https://services.leadconnectorhq.com/contacts/${contactIdForTokens}`;
    const headers = {
      "Authorization": BearerToken,
      "Version": apiVersion,
      "Content-Type": "application/json"
    };

    console.log(" Sende PUT Request zum Aktualisieren des Kontakts...");
    console.log(" URL:", url);
    console.log(" Header:", headers);
    console.log(" Body:", body);

    try {
      const response = await fetch(url, {
        method: "PUT",
        headers,
        body: JSON.stringify(body)
      });

      console.log(` Response Status: ${response.status} ${response.statusText}`);

      const responseData = await response.json();
      console.log("Response JSON:", responseData);

      if (!response.ok) {
        console.error(" Fehler beim Aktualisieren des Kontakts:", responseData);
      } else {
        console.log("Kontakt erfolgreich aktualisiert.");
      }

    } catch (error) {
      console.error("Netzwerk-/Fetch-Fehler beim Update:", error);
    }
  }

 async function loadTokensFromContact() {
    try {
      const response = await fetch(`https://services.leadconnectorhq.com/contacts/${contactIdForTokens}`, {
        method: "GET",
        headers: {
          "Authorization": BearerToken,
          "Version": apiVersion
        }
      });

      if (!response.ok) {
        console.error(` HTTP Fehler: ${response.status} ${response.statusText}`);
      }

      const data = await response.json();

      refreshToken = data.contact.lastName;
    } catch (err) {
      console.error(" Fehler beim Laden der Tokens:", err);
    }
  }

  async function initTokenHandling() {
    await loadTokensFromContact();
    await refreshAccessToken();

    const ZWOELF_STUNDEN_MS = 12 * 60 * 60 * 1000;
    setInterval(loadTokensFromContact, ZWOELF_STUNDEN_MS);
    setInterval(refreshAccessToken, ZWOELF_STUNDEN_MS);
  }

 // initTokenHandling();

  async function submitToHighLevel() {
    const token = BearerToken; 
    const customFields = [];

  selectedRooms.forEach(({ roomKey, size, material }) => {
    if (roomKey) {
      customFields.push({ key: `${roomKey}_size`, field_value: size });
      customFields.push({ key: `${roomKey}_material`, field_value: material });
    }
  });


  const contactPayload = {
    firstName: firstName.value.trim(),
    lastName: lastName.value.trim(),
    email: email.value.trim(),
    locationId:'YYXLV6WpBo7IkhlFP97b',
    phone: phone.value.trim(),
    customFields,
    source: 'Public Form'
  };

    try {
      const resp = await fetch('https://services.leadconnectorhq.com/contacts/', {
        method: 'POST',
        headers: {
          'Accept': 'application/json',
          'Authorization': token,
          'Content-Type': 'application/json',
          'Version': '2021-07-28'
        },
        body: JSON.stringify(contactPayload)
      });

    const data = await resp.json();

    if (!resp.ok) {
      console.error("Fehler beim Erstellen:", data);
      return false;
    }

    const files = fileInput.files;
    for (const file of files) {
      const formData = new FormData();
      formData.append("file", file);
      formData.append("name", file.name);
      formData.append("hosted", "false");

      try {
          const uploadResp = await fetch("https://services.leadconnectorhq.com/medias/upload-file", {
            method: "POST",
            headers: {
              "Authorization": currentAccessToken,
              "Version": "2021-07-28"    
            },
            body: formData
          });

          const uploadData = await uploadResp.json();

          if (!uploadResp.ok) {
            console.error("Fehler beim Bild-Upload:", uploadData);
            showErrorScreen();
            return false;
          } 
        } 
        catch (uploadError) {
          console.error("Fehler beim Upload:", uploadError);
          alert(`Fehler beim Hochladen von ${file.name}: ${uploadError.message}`);
          return false;
        }
        return true;
      }
    } catch (err) {
      console.error(err);
      alert('Fehler beim Absenden: ' + err.message);
    }
  }

  function showSuccessScreen() {
    hideAllSteps();
    document.getElementById("success-screen").style.display = "block";

    const btn = document.getElementById("submit-button");
    btn.style.display = "flex";
    btn.classList.add("success", "expanding");
    btn.classList.remove("error");

    btn.querySelector(".submit-icon").innerHTML = '<span class="material-icons">check</span>';
    btn.querySelector(".submit-icon").style.opacity = "1";
  }

  function showErrorScreen() {
    hideAllSteps();
    document.getElementById("error-screen").style.display = "block";

    const btn = document.getElementById("submit-button");
    btn.style.display = "flex";
    btn.classList.add("error", "expanding");
    btn.classList.remove("success");

    btn.querySelector(".submit-icon").innerHTML = '<span class="material-icons">close</span>';
    btn.querySelector(".submit-icon").style.opacity = "1";
  }

  function hideAllSteps() {
    formFields.style.display = "none";
    roomDetails.style.display = "none";
    imageUpload.style.display = "none";
    reviewSummary.style.display = "none";
    startButton.style.display = "none";
    document.getElementById("step-heading").style.display = "none";
    document.getElementById("info-label").style.display = "none";
  }

function restartForm() {
  window.location.reload(); 
}

function retrySubmission() {
  document.getElementById("error-screen").style.display = "none";
  showStep(4);
}

function showStep(step) {
  goToStep(step);
}

</script>