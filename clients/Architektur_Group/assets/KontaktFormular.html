<!-- ===================================== -->
<!-- Schritt 1: Pers√∂nliche Daten -->
<!-- ===================================== -->

<div class="custom-progress-container">
  <p class="step-label"><span id="step-number">Schritt 1</span> von 4</p>
  <div class="progress">
    <div id="progress-bar" class="progress-bar"></div>
  </div>
  <h2 id="step-heading" class="step-heading">Willkommen</h2>

  <!-- Hinweistext -->
  <p id="info-label" class="info-label">
    *Bitte f√ºllen Sie alle Informationen aus, damit wir Ihre Anfrage bearbeiten k√∂nnen.
  </p>

  <!-- Pers√∂nliche Daten -->
  <div id="personal-form" class="form-fields">
    <div class="form-row">
     <div class="form-group">
      <label for="firstName">Vorname *</label>
      <input type="text" id="firstName" placeholder="Geben Sie Ihren Vornamen ein" />
    </div>
    <div class="form-group">
      <label for="lastName">Nachname *</label>
      <input type="text" id="lastName" placeholder="Geben Sie Ihren Nachnamen ein" />
    </div>
    </div>
    <div class="form-group full">
      <label for="email">E-Mail-Adresse *</label>
      <input type="email" id="email" placeholder="Geben Sie Ihre E-Mail-Adresse ein" />
    </div>
    <div class="form-group full">
      <label for="phone">Telefonnummer *</label>
      <div class="phone-input-group">
        <div class="form-field like-input">
          <div class="custom-select-wrapper">
            <div class="custom-select" id="customCountryCode">
              <div class="selected-option">
                <span class="selected-text">DE +49</span>
                <span class="dropdown-icon">‚ñæ</span>
              </div>
              <div class="options-list hidden">
                <div data-value="+49">DE +49</div>
                <div data-value="+43">AT +43</div>
                <div data-value="+41">CH +41</div>
                <div data-value="+31">NL +31</div>
                <div data-value="+32">BE +32</div>
                <div data-value="+33">FR +33</div>
                <div data-value="+352">LU +352</div>
                <div data-value="+420">CZ +420</div>
                <div data-value="+48">PL +48</div>
                <div data-value="+45">DK +45</div>
                <div data-value="+1">US +1</div>
              </div>
            </div>
            <input type="hidden" name="countryCode" id="realCountryCode" value="+49" />
          </div>
        </div>
        <div class="form-field full-width">
          <input type="tel" id="phone" placeholder="1234567890" />
        </div>
      </div>
    </div>
    <div id="validationErrors" class="form-validation-summary"></div>
  </div>
</div>

<!-- ===================================== -->
<!-- Schritt 2: Zimmerdetails -->
<!-- ===================================== -->
  <div id="room-details" class="room-details custom-progress-container" style="display: none;">
    <div class="form-group full">
      <label for="roomSelect">Raum w√§hlen *</label>
      <div class="custom-select-wrapper wide">
      <div class="custom-select" id="customRoomSelect">

        <div class="selected-option">
          <span class="selected-text">Bitte w√§hlen...</span>
          <span class="dropdown-icon">‚ñæ</span>
        </div>
        <div class="options-list hidden">
          <div data-value="Wohnzimmer">Wohnzimmer</div>
          <div data-value="Schlafzimmer">Schlafzimmer</div>
          <div data-value="K√ºche">K√ºche</div>
          <div data-value="Badezimmer">Badezimmer</div>
          <div data-value="Sonstiges">Sonstiges</div>
        </div>
      </div>
      <input type="hidden" id="roomSelect" name="roomSelect" value="" />
    </div>
  </div>

  <div class="form-group full">
    <label for="roomSize">Quadratmeter *</label>
    <input type="text" id="roomSize" placeholder="z. B. 25" pattern="\d*" inputmode="numeric" />
    <span class="validation-message" id="roomSizeValidation">Bitte geben Sie eine g√ºltige Quadratmeterzahl ein.</span>
  </div>

    <h3 class="materials-heading">Materialvorschl√§ge *</h3>
    <div class="material-grid">
      <div class="material-card">
        <img src="https://media.istockphoto.com/id/1318680899/de/foto/leichter-naturholzhintergrund.jpg?s=2048x2048&w=is&k=20&c=BxLs3us-4r5dHJVGdy7fRtUBdd3TFaQXxlF91vW14zs=" alt="Holzboden" />
        <strong>Holzboden</strong>
        <p>Klassisch und langlebig</p>
      </div>
      <div class="material-card">
        <img src="https://media.istockphoto.com/id/946593026/de/vektor/vektor-wei%C3%9Fen-modernen-abstrakten-hintergrund.jpg?s=2048x2048&w=is&k=20&c=fesT_EAHphSvTx7HBSUP8MzZkkzstcQVhxWltB36e1c=" alt="Fliese" />
        <strong>Fliesen</strong>
        <p>Elegant und wasserfest</p>
      </div>
      <div class="material-card">
        <img src="https://media.istockphoto.com/id/2138862337/de/foto/carpet.jpg?s=2048x2048&w=is&k=20&c=p42TW4njRY436DDwTwm33PWMNlgbcsez5r6fFBi5GgE=" alt="Teppich" />
        <strong>Teppich</strong>
        <p>Weich und schallabsorbierend</p>
      </div>
      <div class="material-card">
        <img src="https://media.istockphoto.com/id/185250199/de/foto/h%C3%B6lzerne-hintergrund.jpg?s=2048x2048&w=is&k=20&c=fm0-yurZ419FBpf-GZ_Qxgm6yZuEOkcykam9NbDXl4M=" alt="Laminat" />
        <strong>Laminat</strong>
        <p>Vielseitig und pflegeleicht</p>
      </div>
      <div class="material-card">
        <img src="https://media.istockphoto.com/id/2155668586/de/foto/schwarze-matte-kunststoffmaterialstruktur.jpg?s=2048x2048&w=is&k=20&c=e_pF9EQ3zkKR5h2LZdX286mnGYtwVACn8ywU0gPlBeo=" alt="Vinyl" />
        <strong>Vinyl</strong>
        <p>Wasserfest und einfach zu reinigen</p>
      </div>
    </div>

    <div id="step2ValidationErrors" class="form-validation-summary"></div>

    <button type="button" id="addRoomButton" class="start-button" style="margin-bottom: 20px;">Hinzuf√ºgen</button>

      <div id="roomList" class="room-list"></div>
  </div>
  
<!-- ===================================== -->
<!-- Schritt 3: Bilder hochladen -->
<!-- ===================================== -->
  <div id="image-upload" class="image-upload custom-progress-container" style="display: none;">
    <div id="drop-zone" class="drop-zone">
      <p><strong>Ziehe deine Bilder hierher</strong><br />oder klicke zum Durchsuchen</p>
      <input type="file" id="file-input" accept=".pdf,image/jpeg,image/jpg" multiple hidden />
      <button type="button" id="upload-button" class="start-button">Hochladen</button>
    </div>

    <div class="uploaded-images">
      <h4>Hochgeladene Bilder</h4>
      <div id="gallery" class="gallery"></div>
    </div>
  </div>
  
<!-- ===================================== -->
<!-- Schritt 4: Zusammenfassung -->
<!-- ===================================== -->
<div id="review-summary" class="review-summary custom-progress-container" style="display: none;">
  <div class="review-section">
    <h4 style="display: flex; align-items: center; justify-content: space-between;">
        Pers√∂nliche Daten
      <div class="tooltip-container">
        <button class="edit-button" onclick="goToStep(1)">
        <svg xmlns="http://www.w3.org/2000/svg" height="20" viewBox="0 0 24 24" width="20" fill="#ffd700">
        <path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04a1.003 1.003 0 0 0 0-1.41l-2.34-2.34a1.003 1.003 0 0 0-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"/>
  </svg>
</button>

      <span class="tooltip-text">Bearbeiten</span>
    </div>
    </h4>

    <ul>
      <li><strong>Vorname:</strong> <span id="summaryFirstName"></span></li>
      <li><strong>Nachname:</strong> <span id="summaryLastName"></span></li>
      <li><strong>E-Mail:</strong> <span id="summaryEmail"></span></li>
      <li><strong>Telefonnummer:</strong> <span id="summaryPhone"></span></li>
    </ul>
  </div>

  <div class="review-section">
    <h4 style="display: flex; align-items: center; justify-content: space-between;">
        Zimmerdetails
        <div class="tooltip-container">
          <button class="edit-button" onclick="goToStep(1)">
            <svg xmlns="http://www.w3.org/2000/svg" height="20" viewBox="0 0 24 24" width="20" fill="#ffd700">
          <path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04a1.003 1.003 0 0 0 0-1.41l-2.34-2.34a1.003 1.003 0 0 0-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"/>
  </svg>
</button>

        <span class="tooltip-text">Bearbeiten</span>
      </div>
    </h4>
    <ul>
      <li><span id="summaryRoom"></span></li>
      <li><span id="summaryMaterial"></span></li>
    </ul>
  </div>

  <div class="review-section">
    <h4 style="display: flex; align-items: center; justify-content: space-between;">
        Hochgeladene Bilder
      <div class="tooltip-container">
        <button class="edit-button" onclick="goToStep(1)">
          <svg xmlns="http://www.w3.org/2000/svg" height="20" viewBox="0 0 24 24" width="20" fill="#ffd700">
            <path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04a1.003 1.003 0 0 0 0-1.41l-2.34-2.34a1.003 1.003 0 0 0-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"/>
          </svg>
        </button>
        <span class="tooltip-text">Bearbeiten</span>
      </div>
    </h4>
    <div id="summaryGallery" class="gallery"></div>
  </div>
</div>

<button id="start-button" class="start-button" disabled>Weiter</button>
<button id="submit-button" class="start-button" style="display: none;">Absenden</button>

<style>
 /* ===================================== */
/* Global Styles */
/* ===================================== */

@import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');

* {
  font-family: 'Inter', sans-serif;
}

body {
  background-color: transparent;
  color: #fff;
  margin: 0;
  padding: 0;
}

input:-webkit-autofill,
input:-webkit-autofill:focus,
input:-webkit-autofill:hover,
input:-webkit-autofill:active {
  -webkit-box-shadow: 0 0 0px 1000px transparent inset !important;
  background-color: transparent !important;
  -webkit-text-fill-color: #fff !important;
  caret-color: #fff;
}

input,
select {
  border: none;
  border-bottom: 2px solid #ccc;
  border-radius: 0;
  padding: 10px 4px 6px 4px;
  font-size: 16px;
  color: #fff;
  transition: border-color 0.3s, box-shadow 0.3s;
  outline: none;
  box-shadow: none !important;
}

input::placeholder {
  color: #aaa;
  opacity: 1;
}

input.touched.invalid {
  border-bottom-color: #e74c3c;
}

input.touched.valid {
  border-bottom: 2px solid transparent !important;
  background-image: linear-gradient(to right, #a47148, #ffd700);
  background-repeat: no-repeat;
  background-size: 100% 2px;
  background-position: 0 100%;
}

select {
  appearance: none;
  background-color: transparent;
  color: #fff;
  border-bottom: 2px solid #ccc;
  background-image: url("data:image/svg+xml;utf8,<svg fill='white' height='16' viewBox='0 0 24 24' width='16' xmlns='http://www.w3.org/2000/svg'><path d='M7 10l5 5 5-5z'/></svg>");
  background-repeat: no-repeat;
  background-position: right 8px center;
  background-size: 16px 16px;
  width: 100%;
}

.options-list::-webkit-scrollbar {
  width: 8px;
  height: 8px;
}

.options-list::-webkit-scrollbar-track {
  background: transparent;
}

.options-list::-webkit-scrollbar-thumb {
  background-color: #ffd700;
  border-radius: 4px;
  border: none;
}

.options-list::-webkit-scrollbar-button {
  display: none;
}

.options-list::-webkit-scrollbar-corner {
  background: transparent;
}

.options-list {
  scrollbar-width: thin;
  scrollbar-color: #ffd700 transparent;
}

/* ===================================== */
/* Schritt 1: Pers√∂nliche Daten */
/* ===================================== */

.custom-progress-container {
  max-width: 600px;
  margin: 0 auto;
  padding: 40px 20px;
}

.step-label {
  font-size: 18px;
  font-weight: bold;
  margin-bottom: 6px;
  text-align: center;
}

.progress {
  width: 100%;
  height: 8px;
  background-color: #333;
  border-radius: 20px;
  margin-bottom: 30px;
  position: relative;
}

.progress-bar {
  height: 100%;
  width: 25%;
  border-radius: 20px;
  background-image: linear-gradient(120deg, #a47148 20%, #ffd700 50%, #a47148 80%);
  background-size: 200% 100%;
  background-position: -100% 0;
  animation: shimmer-progress-bar 6s ease-in-out infinite;
  box-shadow: 0 0 10px #ffd70066;
}

@keyframes shimmer-progress-bar {
  0% { background-position: -100% 0; }
  50% { background-position: 100% 0; }
  100% { background-position: -100% 0; }
}

.step-heading {
  text-align: center;
  font-size: 20px;
  font-weight: bold;
}

.info-label {
  font-size: 14px;
  color: #999;
  text-align: center;
  margin-bottom: 20px;
}

.form-fields {
  margin-bottom: 30px;
}

.form-row {
  display: flex;
  gap: 20px;
  flex-wrap: wrap;
}

.form-group {
  flex: 1;
  display: flex;
  flex-direction: column;
  margin-bottom: 20px;
}

.form-group.full {
  width: 100%;
}

.form-group label {
  font-weight: bold;
  margin-bottom: 6px;
}

.phone-input-group {
  display: flex;
  gap: 12px;
  align-items: flex-end;
}

.phone-input-group .form-field.full-width {
  flex: 1;
  display: flex;
}

.phone-input-group .form-field.full-width input {
  width: 100%;
}

.phone-input-group.invalid .form-field.like-input {
  border-bottom: 2px solid #e74c3c !important;
}

.phone-input-group.valid .form-field.like-input {
  border-bottom: 2px solid transparent !important;
  background-image: linear-gradient(to right, #a47148, #ffd700);
  background-repeat: no-repeat;
  background-size: 100% 2px;
  background-position: 0 100%;
}

.phone-input-group .form-field.like-input {
  flex: 0 0 120px;
  display: flex;
  align-items: flex-end;
  border-bottom: 2px solid #ccc;
}

.custom-select-wrapper {
  width: 100%;
  position: relative;
}

.custom-select {
  display: flex;
  align-items: center;
  cursor: pointer;
  color: #fff;
  font-size: 16px;
}

.custom-select .selected-option {
  display: flex;
  justify-content: space-between;
  align-items: center;
  height: 40px;
}

.custom-select .dropdown-icon {
  margin-left: 32px;
  color: #fff;
}

.custom-select .options-list {
  position: absolute;
  top: 100%;
  left: 0;
  width: 100%;
  max-height: 160px;
  overflow-y: auto;
  background-color: #111;
  border: 1px solid #333;
  border-radius: 4px;
  z-index: 999;
}

.custom-select .options-list div {
  padding: 10px;
  cursor: pointer;
}

.custom-select .options-list div:hover {
  background-color: #444;
}

.custom-select .options-list.hidden {
  display: none;
}

/* ===================================== */
/* Schritt 2: Zimmerdetails */
/* ===================================== */

.room-details {
  margin-top: 20px;
}

.materials-heading {
  margin: 30px 0 10px;
  font-size: 18px;
  font-weight: bold;
}

.material-grid {
  display: flex;
  flex-wrap: wrap;
  gap: 20px;
  justify-content: space-between;
}

.material-card {
  flex: 1 1 120px;
  max-width: 150px;
  text-align: center;
  padding: 10px;
  border: 2px solid transparent;
  border-radius: 12px;
  cursor: pointer;
  background-image:
    linear-gradient(#000, #000),
    linear-gradient(135deg, #a47148 40%, #ffd700 50%, #a47148 60%);
  background-origin: border-box;
  background-clip: padding-box, border-box;
  transition: all 0.2s ease;
}

.material-card:hover {
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
}

.material-card.selected {
  border-color: #ffd700;
  background: linear-gradient(135deg, #1e1e1e, #000);
  box-shadow: 0 0 8px #ffd700aa;
  transform: scale(1.02);
}

.material-card img {
  width: 100%;
  border-radius: 6px;
  margin-bottom: 8px;
}

.material-card p {
  font-size: 13px;
  color: #555;
}

.custom-select-wrapper.wide {
  border-bottom: 2px solid #ccc;
  padding-bottom: 4px;
}

.custom-select-wrapper.wide.valid {
  border-bottom: 2px solid transparent;
  background-image: linear-gradient(to right, #a47148, #ffd700);
  background-repeat: no-repeat;
  background-size: 100% 2px;
  background-position: 0 100%;
}

.custom-select-wrapper.wide.invalid {
  border-bottom: 2px solid #e74c3c;
}

/* ===================================== */
/* Schritt 3: Bild-Upload */
/* ===================================== */

.image-upload {
  margin-top: 30px;
}

.drop-zone {
  position: relative;
  padding: 40px;
  text-align: center;
  cursor: pointer;
  margin-bottom: 30px;
  z-index: 1;
  background-color: transparent;
}

.drop-zone::before {
  content: "";
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background:
    repeating-linear-gradient(to right, #a47148 0, #ffd700 8px, transparent 8px, transparent 16px),
    repeating-linear-gradient(to bottom, #a47148 0, #ffd700 8px, transparent 8px, transparent 16px),
    repeating-linear-gradient(to left, #a47148 0, #ffd700 8px, transparent 8px, transparent 16px),
    repeating-linear-gradient(to top, #a47148 0, #ffd700 8px, transparent 8px, transparent 16px);
  background-repeat: no-repeat;
  background-size:
    100% 2px,
    2px 100%,
    100% 2px,
    2px 100%;
  background-position:
    top left,
    top right,
    bottom left,
    top left;
  pointer-events: none;
  z-index: 2;
}

.drop-zone:hover {
  background-color: #111;
}

.uploaded-images h4 {
  margin-bottom: 10px;
}

.gallery {
  display: flex;
  gap: 20px;
  flex-wrap: wrap;
}

.gallery img {
  width: 160px;
  border-radius: 10px;
  object-fit: cover;
  box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
}

/* ===================================== */
/* Schritt 4: Zusammenfassung */
/* ===================================== */

.review-summary {
  margin-top: 30px;
}

.review-section {
  margin-bottom: 30px;
}

.review-section h4 {
  display: flex;
  align-items: center;
  justify-content: space-between;
  font-size: 16px;
  margin-bottom: 10px;
}

.review-section ul {
  list-style: none;
  padding: 0;
  margin: 0;
}

.review-section ul li {
  padding: 4px 0;
  font-size: 14px;
}

.edit-button {
  background: none;
  border: none;
  font-size: 18px;
  cursor: pointer;
  color: #ffd700;
  padding: 4px;
  filter: drop-shadow(0 0 3px #ffd700);
  transition: transform 0.2s ease;
}

.edit-button:hover {
  transform: scale(1.15);
  text-shadow: 0 0 6px #ffd700;
}


.tooltip-container {
  position: relative;
  display: inline-block;
}

.tooltip-text {
  visibility: hidden;
  background-color: #000;
  color: #fff;
  border-radius: 6px;
  padding: 4px 8px;
  font-size: 12px;
  position: absolute;
  top: -5px;
  right: 130%;
  white-space: nowrap;
  opacity: 0;
  transition: opacity 0.3s;
}

.tooltip-container:hover .tooltip-text {
  visibility: visible;
  opacity: 1;
}

#review-summary {
  margin-top: 0 !important;
  padding-top: 0 !important;
}

#review-summary .review-section:first-of-type {
  margin-top: 0 !important;
}

#info-label {
  margin-bottom: 0 !important;
  padding-bottom: 0 !important;
}

.review-summary .info-label {
  margin-bottom: 10px !important;
}

/* ===================================== */
/* Buttons */
/* ===================================== */

.start-button {
  display: block;
  margin: 30px auto 0 auto;
  padding: 12px 24px;
  font-size: 16px;
  background: transparent;
  color: #ffd700;
  border: 2px solid transparent;
  border-image: linear-gradient(135deg, #a47148 40%, #ffd700 50%, #a47148 60%);
  border-image-slice: 1;
  border-radius: 8px;
  cursor: pointer;
  transition: all 0.3s ease;
  animation: shimmer-border 4s ease-in-out infinite;
}

.start-button:hover:not(:disabled) {
  background-color: rgba(255, 215, 0, 0.05);
  box-shadow: 0 0 8px #ffd700aa;
}

.start-button:disabled {
  opacity: 0.3;
  border-color: #555;
  color: #999;
  cursor: not-allowed;
  border-image: none;
}

@keyframes shimmer-border {
  0% {
    border-image-source: linear-gradient(120deg, #a47148 30%, #ffd700 50%, #a47148 70%);
  }
  50% {
    border-image-source: linear-gradient(120deg, #a47148 10%, #fff2b0 50%, #a47148 90%);
  }
  100% {
    border-image-source: linear-gradient(120deg, #a47148 30%, #ffd700 50%, #a47148 70%);
  }
}
</style>

<script>
  let currentStep = 1;
  const maxSteps = 4;

  const phoneGroup = document.querySelector(".phone-input-group");
  const stepNumber = document.getElementById('step-number');
  const progressBar = document.getElementById('progress-bar');
  const stepHeading = document.getElementById('step-heading');
  const startButton = document.getElementById('start-button');
  const submitButton = document.getElementById('submit-button'); 
  const infoLabel = document.getElementById('info-label');
  const countryCode = document.getElementById('countryCode');

  const customSelect = document.getElementById("customCountryCode");
  const selectedOption = customSelect.querySelector(".selected-option");
  const optionsList = customSelect.querySelector(".options-list");
  const realInput = document.getElementById("realCountryCode");
  const selectedText = selectedOption.querySelector(".selected-text");


  const formFields = document.getElementById('personal-form');
  const roomDetails = document.getElementById('room-details');
  const imageUpload = document.getElementById('image-upload');
  const reviewSummary = document.getElementById('review-summary');

  const firstName = document.getElementById('firstName');
  const lastName = document.getElementById('lastName');
  const email = document.getElementById('email');
  const phone = document.getElementById('phone');

  const roomSelect = document.getElementById('roomSelect');
  const roomSize = document.getElementById('roomSize');
  const roomSizeValidation = document.getElementById('roomSizeValidation');
  const addRoomButton = document.getElementById('addRoomButton');
  const roomList = document.getElementById('roomList');
  const customRoomWrapper = document.getElementById("customRoomSelect");
  const roomSelectedOption = customRoomWrapper.querySelector(".selected-option");
  const roomOptionsList = customRoomWrapper.querySelector(".options-list");
  const realRoomInput = document.getElementById("roomSelect");
  const roomText = roomSelectedOption.querySelector(".selected-text");
  let selectedRooms = [];
  let selectedMaterial = null;
  let roomDropdownOpen = false;
  let roomTouched = false;
  let sizeTouched = false;
  let materialTouched = false;

  const dropZone = document.getElementById('drop-zone');
  const fileInput = document.getElementById('file-input');
  const gallery = document.getElementById('gallery');
  const uploadButton = document.getElementById('upload-button');

  const summaryFirstName = document.getElementById('summaryFirstName');
  const summaryLastName = document.getElementById('summaryLastName');
  const summaryEmail = document.getElementById('summaryEmail');
  const summaryPhone = document.getElementById('summaryPhone');
  const summaryRoom = document.getElementById('summaryRoom');
  const summaryMaterial = document.getElementById('summaryMaterial');
  const summaryGallery = document.getElementById('summaryGallery');

  const materialCards = document.querySelectorAll('.material-card');

  if (currentStep === 1) {
  document.getElementById('step-heading').style.display = 'none';
  document.getElementById('info-label').style.display = 'none';
}

  materialCards.forEach(card => {
    card.addEventListener('click', () => {
      const isSelected = card.classList.contains('selected');
      materialCards.forEach(c => c.classList.remove('selected'));
      if (!isSelected) {
        card.classList.add('selected');
        selectedMaterial = card.querySelector('strong')?.innerText || null;
      } else {
        selectedMaterial = null;
      }
      validateStep2();
    });
  });

  const headings = [
    "Willkommen",
    "Zimmerdetails",  
    "Bilder hochladen",    
    "Anfrage √ºberpr√ºfen"     
  ];

  const customWrapper = document.querySelector('.form-field.like-input');

  let isDropdownOpen = false;

  customWrapper.addEventListener("click", (e) => {
    e.stopPropagation();
    isDropdownOpen = !isDropdownOpen;

    optionsList.classList.toggle("hidden", !isDropdownOpen);
    selectedOption.classList.toggle("open", isDropdownOpen);
  });

    optionsList.querySelectorAll("div").forEach(option => {
    option.addEventListener("click", (e) => {
      e.stopPropagation();

      const value = option.dataset.value;
      selectedText.textContent = option.textContent;
      realInput.value = value;

      isDropdownOpen = false;
      optionsList.classList.add("hidden");
      selectedOption.classList.remove("open");
    });
  });

  // Click outside to close
  document.addEventListener("click", (e) => {
    if (!customSelect.contains(e.target)) {
      optionsList.classList.add("hidden");
      selectedOption.classList.remove("open");
    }
  });

  // Schritt 1 validieren
function validateStep1() {
  const errors = [];
  let isValid = true;

  const nameRegex = /^[A-Za-z√Ñ√ñ√ú√§√∂√º√ü\s-]{2,}$/;
  const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;

  // Vorname
  if (firstName.classList.contains("touched")) {
    if (!nameRegex.test(firstName.value.trim())) {
      markInvalid(firstName);
      errors.push("Bitte geben Sie einen g√ºltigen Vornamen ein.");
      isValid = false;
    } else {
      markValid(firstName);
    }
  }

  // Nachname
  if (lastName.classList.contains("touched")) {
    if (!nameRegex.test(lastName.value.trim())) {
      markInvalid(lastName);
      errors.push("Bitte geben Sie einen g√ºltigen Nachnamen ein.");
      isValid = false;
    } else {
      markValid(lastName);
    }
  }

  // E-Mail
  if (email.classList.contains("touched")) {
    if (!emailRegex.test(email.value.trim())) {
      markInvalid(email);
      errors.push("Bitte geben Sie eine g√ºltige E-Mail-Adresse ein.");
      isValid = false;
    } else {
      markValid(email);
    }
  }

  // Telefonnummer
  if (phone.classList.contains("touched")) {
    if (!/^\d{5,}$/.test(phone.value.trim())) {
      markInvalid(phone);
      phoneGroup.classList.remove("valid");
      phoneGroup.classList.add("invalid");
      errors.push("Bitte geben Sie eine g√ºltige Telefonnummer ein (mind. 5 Ziffern).");
      isValid = false;
    } else {
      markValid(phone);
      phoneGroup.classList.remove("invalid");
      phoneGroup.classList.add("valid");
    }
  }

  // Fehler nur anzeigen, wenn mindestens ein Feld touched wurde
  const touchedFields = [firstName, lastName, email, phone].some(el => el.classList.contains("touched"));
  const errorContainer = document.getElementById("validationErrors");
  errorContainer.innerHTML = touchedFields ? errors.map(err => `<div>‚Ä¢ ${err}</div>`).join("") : "";

  // Startbutton aktivieren, wenn alles g√ºltig ist
  startButton.disabled = !(
      nameRegex.test(firstName.value.trim()) &&
      nameRegex.test(lastName.value.trim()) &&
      emailRegex.test(email.value.trim()) &&
      /^\d{5,}$/.test(phone.value.trim())
    );
  }

function markInvalid(input) {
  input.classList.remove("valid");
  input.classList.add("invalid");
}

function markValid(input) {
  input.classList.remove("invalid");
  input.classList.add("valid");
}

 // Event-Handler f√ºr Schritt 1
[firstName, lastName, email, phone].forEach(input => {
  input.addEventListener("blur", () => {
    input.classList.add("touched");
    validateStep1();
  });

  input.addEventListener("input", () => {
    validateStep1();
  });
});

 // Schritt 2 validieren
function validateStep2() {
  const errors = [];
  const isRoomSelected = roomSelect.value !== '';
  const sizeValid = parseInt(roomSize.value) > 0;
  const hasMaterial = selectedMaterial !== null;

  // Linie beim Raumfeld (Dropdown)
  const roomWrapper = document.querySelector('.custom-select-wrapper.wide');
  if (!isRoomSelected && roomTouched) {
    roomWrapper.classList.remove("valid");
    roomWrapper.classList.add("invalid");
  } else if (roomTouched) {
    roomWrapper.classList.remove("invalid");
    roomWrapper.classList.add("valid");
  }

  // Linie beim Quadratmeterfeld
  if (!sizeValid && sizeTouched) {
    roomSize.classList.remove("valid");
    roomSize.classList.add("invalid");
  } else if (sizeTouched) {
    roomSize.classList.remove("invalid");
    roomSize.classList.add("touched", "valid");
  }

  // Material-Auswahl aktivieren/deaktivieren
  const enableMaterials = isRoomSelected && sizeValid;
  materialCards.forEach(card => {
    card.style.pointerEvents = enableMaterials ? "auto" : "none";
    card.style.opacity = enableMaterials ? "1" : "0.5";
  });

  // Fehlermeldungen sammeln
  if (!isRoomSelected && roomTouched) errors.push("Bitte w√§hlen Sie einen Raum aus.");
  if (!sizeValid && sizeTouched) errors.push("Bitte geben Sie eine g√ºltige Quadratmeterzahl ein.");
  if (!hasMaterial && materialTouched) errors.push("Bitte w√§hlen Sie ein Material aus.");

  // Fehlermeldungen anzeigen
  document.getElementById("step2ValidationErrors").innerHTML = errors.length > 0
    ? errors.map(msg => `<div>‚Ä¢ ${msg}</div>`).join("")
    : "";

  // Buttons aktivieren
  addRoomButton.disabled = !(isRoomSelected && sizeValid && hasMaterial);
  startButton.disabled = !(selectedRooms.length > 0);
}

  customRoomWrapper.addEventListener("click", (e) => {
    e.stopPropagation();
    roomDropdownOpen = !roomDropdownOpen;
    roomOptionsList.classList.toggle("hidden", !roomDropdownOpen);
    roomSelectedOption.classList.toggle("open", roomDropdownOpen);
  });

  roomOptionsList.querySelectorAll("div").forEach(option => {
    option.addEventListener("click", (e) => {
      e.stopPropagation();
      const value = option.dataset.value;
      roomText.textContent = value;
      realRoomInput.value = value;

      roomTouched = true;

      roomDropdownOpen = false;
      roomOptionsList.classList.add("hidden");
      roomSelectedOption.classList.remove("open");
      validateStep2();
    });
  });

  roomSize.addEventListener("input", () => {
    sizeTouched = true;
    validateStep2();
  });

  materialCards.forEach(card => {
    card.addEventListener('click', () => {
      materialTouched = true;
      validateStep2();
    });
  });

  document.addEventListener("click", (e) => {
    if (!customRoomWrapper.contains(e.target)) {
      roomOptionsList.classList.add("hidden");
      roomSelectedOption.classList.remove("open");
      roomDropdownOpen = false;
    }
  });

// Initial deaktivieren
addRoomButton.disabled = true;
roomSizeValidation.style.display = 'none';

roomSelect.addEventListener("change", validateStep2);
roomSize.addEventListener("input", validateStep2);

// Events anpassen (z.‚ÄØB. nach Materialauswahl validieren)
addRoomButton.addEventListener("click", () => {
  const room = roomSelect.value;
  const size = roomSize.value;
  const material = selectedMaterial;

  if (room && parseInt(size) > 0 && material) {
    const roomKeyRaw = room.toLowerCase().replace('√§', 'ae').replace('√∂', 'oe').replace('√º', 'ue');

    const fieldMap = {
      wohnzimmer: 'living_room',
      schlafzimmer: 'bed_room',
      badezimmer: 'bathroom',
      kueche: 'kitchen'
    };

    const mappedRoom = fieldMap[roomKeyRaw]; 

    selectedRooms = selectedRooms.filter(r => r.roomLabel !== room);

    // Speichern ‚Äì mit oder ohne API-Schl√ºssel
    selectedRooms.push({
      roomKey: mappedRoom || null,
      roomLabel: room,
      size,
      material
    });

    // UI zur√ºcksetzen
    roomSelect.value = '';
    roomSize.value = '';
    selectedMaterial = null;
    materialCards.forEach(c => c.classList.remove('selected'));
    roomSize.classList.remove("valid", "invalid", "touched");

    roomTouched = false;
    sizeTouched = false;
    materialTouched = false;

    validateStep2();
    updateRoomList();
  }
});

function updateRoomList() {
  roomList.innerHTML = '';

  if (selectedRooms.length === 0) return;

  const table = document.createElement('table');
  table.style.width = '100%';
  table.style.borderCollapse = 'collapse';
  table.style.marginTop = '10px';

  const headerRow = document.createElement('tr');
  ['Raum', 'Gr√∂√üe', 'Material'].forEach(text => {
    const th = document.createElement('th');
    th.textContent = text;
    th.style.borderBottom = '1px solid #ccc';
    th.style.textAlign = 'left';
    th.style.padding = '6px';
    headerRow.appendChild(th);
  });
  table.appendChild(headerRow);

  selectedRooms.forEach(entry => {
  const row = document.createElement('tr');
    [entry.roomLabel, `${entry.size} m¬≤`, entry.material].forEach(val => {
      const td = document.createElement('td');
      td.textContent = val;
      td.style.padding = '6px';
      row.appendChild(td);
    });
    table.appendChild(row);
  });
  roomList.appendChild(table);
}

  // Weiter-Button (Schritt 1‚Äì3)
  startButton.addEventListener("click", () => {
    if ((currentStep === 1 && startButton.disabled) || (currentStep === 2 && startButton.disabled)) {
      return;
    }

    if (currentStep < maxSteps) {
      currentStep++;
      document.querySelector('.custom-progress-container').scrollIntoView({ behavior: 'smooth' });
      stepNumber.textContent = `Schritt ${currentStep}`;
      progressBar.style.width = `${currentStep * 25}%`;
      stepHeading.textContent = headings[currentStep - 1];

      document.getElementById('step-heading').style.display = currentStep === 1 ? 'none' : 'block';
      document.getElementById('info-label').style.display = currentStep === 1 ? 'none' : 'block';

      // Zeige/Verstecke Buttons
      startButton.style.display = currentStep < maxSteps ? "block" : "none";
      submitButton.style.display = currentStep === maxSteps ? "block" : "none";

      // Inhalt sichtbar machen
      formFields.style.display = currentStep === 1 ? "block" : "none";
      roomDetails.style.display = currentStep === 2 ? "block" : "none";
      imageUpload.style.display = currentStep === 3 ? "block" : "none";
      reviewSummary.style.display = currentStep === 4 ? "block" : "none";

      if (currentStep === 2) {
        validateStep2();
      } else {
        startButton.disabled = false;
      }

      // Schritt 4 zusammenfassen
     if (currentStep === 4) {

      infoLabel.textContent = "Bitte √ºberpr√ºfen Sie alle Informationen nochmal gr√ºndlich.";

      summaryFirstName.textContent = firstName.value;
      summaryLastName.textContent = lastName.value;
      summaryEmail.textContent = email.value;
      summaryPhone.textContent = `${realInput.value} ${phone.value}`;

    // Raum-√úbersicht als Tabelle
    summaryRoom.innerHTML = '';
    if (selectedRooms.length > 0) {
      const table = document.createElement('table');
      table.style.width = '100%';
      table.style.borderCollapse = 'collapse';

      const headerRow = document.createElement('tr');
      ['Raum', 'Gr√∂√üe', 'Material'].forEach(text => {
        const th = document.createElement('th');
        th.textContent = text;
        th.style.borderBottom = '1px solid #ccc';
        th.style.textAlign = 'left';
        th.style.padding = '6px';
        headerRow.appendChild(th);
      });
      table.appendChild(headerRow);

      selectedRooms.forEach(entry => {
        const row = document.createElement('tr');
        [entry.roomLabel, `${entry.size} m¬≤`, entry.material].forEach(val => {
          const td = document.createElement('td');
          td.textContent = val;
          td.style.padding = '6px';
          row.appendChild(td);
        });
        table.appendChild(row);
      });

      summaryRoom.appendChild(table);
    } else {
      summaryRoom.textContent = 'Keine Angaben gemacht';
    }

    summaryMaterial.textContent = '';
    summaryGallery.innerHTML = "";

  Array.from(gallery.children).forEach(node => {
    const clone = node.cloneNode(true);
    summaryGallery.appendChild(clone);
  });

  }
    }
  });

  function goToStep(step) {
      if (step < 1 || step > maxSteps) return;

      currentStep = step;
      stepNumber.textContent = `Schritt ${currentStep}`;
      progressBar.style.width = `${currentStep * 25}%`;
      stepHeading.textContent = headings[currentStep - 1];
      document.getElementById('step-heading').style.display = currentStep === 1 ? 'none' : 'block';
      document.getElementById('info-label').style.display = currentStep === 1 ? 'none' : 'block';
      document.querySelector('.custom-progress-container').scrollIntoView({ behavior: 'smooth' });

      formFields.style.display = currentStep === 1 ? "block" : "none";
      roomDetails.style.display = currentStep === 2 ? "block" : "none";
      imageUpload.style.display = currentStep === 3 ? "block" : "none";
      reviewSummary.style.display = currentStep === 4 ? "block" : "none";

      startButton.style.display = currentStep < maxSteps ? "block" : "none";
      submitButton.style.display = currentStep === maxSteps ? "block" : "none";

      if (currentStep === 1) validateStep1();
      if (currentStep === 2) validateStep2();
  }

  // Bild Uploads

  dropZone.addEventListener('dragover', (e) => {
    e.preventDefault();
    dropZone.style.backgroundColor = '#f1f1f1';
  });

  phone.addEventListener("input", () => {
    // Erlaube nur Zahlen
    phone.value = phone.value.replace(/\D/g, "");
   validateStep1();
  });

  dropZone.addEventListener('dragleave', () => {
    dropZone.style.backgroundColor = 'transparent';
  });

  dropZone.addEventListener('drop', (e) => {
    e.preventDefault();
    dropZone.style.backgroundColor = 'transparent';
    handleFiles(e.dataTransfer.files);
  });

  uploadButton.addEventListener('click', () => fileInput.click());

  fileInput.addEventListener('change', () => {
    handleFiles(fileInput.files);
  });

function handleFiles(files) {
  const allowedTypes = ['application/pdf', 'image/jpeg', 'image/jpg'];

  Array.from(files).forEach(file => {
    if (!allowedTypes.includes(file.type)) {
      alert(`Dateiformat nicht erlaubt: ${file.name}`);
      return;
    }

    const reader = new FileReader();
    reader.onload = (e) => {
      const wrapper = document.createElement('div');
      wrapper.style.width = '160px';
      wrapper.style.border = '1px solid #ddd';
      wrapper.style.borderRadius = '10px';
      wrapper.style.overflow = 'hidden';
      wrapper.style.boxShadow = '0 2px 5px rgba(0,0,0,0.1)';
      wrapper.style.background = '#fff';
      wrapper.style.textAlign = 'center';
      wrapper.style.display = 'flex';
      wrapper.style.flexDirection = 'column';
      wrapper.style.justifyContent = 'center';
      wrapper.style.padding = '10px';

      if (file.type === 'application/pdf') {
        const icon = document.createElement('div');
        icon.innerHTML = 'üìÑ';
        icon.style.fontSize = '48px';
        icon.style.marginBottom = '8px';

        const filename = document.createElement('div');
        filename.textContent = file.name;
        filename.style.fontSize = '12px';
        filename.style.overflow = 'hidden';
        filename.style.textOverflow = 'ellipsis';
        filename.style.whiteSpace = 'nowrap';

        wrapper.appendChild(icon);
        wrapper.appendChild(filename);
      } else {
        const img = document.createElement('img');
        img.src = e.target.result;
        img.style.width = '100%';
        img.style.height = 'auto';
        img.style.objectFit = 'cover';
        wrapper.appendChild(img);
      }

      gallery.appendChild(wrapper);
    };

    reader.readAsDataURL(file);
  });
}

 configJson = {
  "baseUrl": "https://marketplace.gohighlevel.com",
  "clientId": "684738bd49eac24e868b4001-mbpi9wpo",
  "clientSecret": "e29f60ba-aba5-49ea-a91f-30225d29563e",
}

// Authentication
async function initiateAuth(req, res) {
  const options = {
    requestType: "code",
    redirectUri: "http://localhost:3000/oauth/callback",
    clientId: configJson.clientId,
    scopes: [
      "contacts.write",
      "contacts.readonly"
    ]
  }
  return res.redirect(`${configJson.baseUrl}/oauth/chooselocation?response_type=${options.requestType}&redirect_uri=${options.redirectUri}&client_id=${options.clientId}&scope=${options.scopes.join(' ')}`);
}

  // Submit an GoHighLevel
  submitButton.addEventListener("click", () => {
    submitToHighLevel();
  });

  async function submitToHighLevel() {
    const token = 'Bearer pit-df626d04-ebd5-45d8-8548-d589f9d5c903'; 
    const customFields = [];

  selectedRooms.forEach(({ roomKey, size, material }) => {
    if (roomKey) {
      customFields.push({ key: `${roomKey}_size`, field_value: size });
      customFields.push({ key: `${roomKey}_material`, field_value: material });
    }
  });


    const contactPayload = {
      firstName: firstName.value.trim(),
      lastName: lastName.value.trim(),
      email: email.value.trim(),
      locationId:'YYXLV6WpBo7IkhlFP97b',
      phone: phone.value.trim(),
      customFields,
      source: 'Public Form'
    };

    try {
      const resp = await fetch('https://services.leadconnectorhq.com/contacts/', {
        method: 'POST',
        headers: {
          'Accept': 'application/json',
          'Authorization': token,
          'Content-Type': 'application/json',
          'Version': '2021-07-28'
        },
        body: JSON.stringify(contactPayload)
      });

    const data = await resp.json();

    if (!resp.ok) {
      console.error("Fehler beim Erstellen:", data);
      alert('Fehler beim Erstellen des Kontakts: ' + (data.error || JSON.stringify(data)));
      return;
    }

      // Bilder anh√§ngen

      alert('Kontakt erfolgreich erstellt! ‚úÖ');
    } catch (err) {
      console.error(err);
      alert('Fehler beim Absenden: ' + err.message);
    }
  }
</script>